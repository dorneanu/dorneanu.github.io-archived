<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="keywords" content="nginx, php, admin, debian, chroot">
        <meta name="description" content="Although I thought this would be an easy task, it turned out that chrooting daemons takes more than copying config files and libraries. There are donzens of tutorials out there how to do it, but the devil lies in detail - as always. Setting up a chroot environment is easy. But ...">
        <title>HowTo: Put nginx and PHP to jail in Debian 8 - blog.dornea.nu</title>
        <link rel="shortcut icon" type="image/x-icon" href="/favicon.png">
        <link rel="stylesheet" href="http://blog.dornea.nu/theme/css/bootstrap.min.css" type="text/css" />
        <link rel="stylesheet" href="http://blog.dornea.nu/theme/font-icons/style.min.css" type="text/css" />
        <link rel="stylesheet" href="http://blog.dornea.nu/theme/css/niu2.min.css" type="text/css" />
        <link rel="stylesheet" href="/css/custom.css" type="text/css" />
        <link rel="canonical" href="http://blog.dornea.nu/2016/01/15/howto-put-nginx-and-php-to-jail-in-debian-8" />
        <script type="text/javascript">window.onload=function(){};</script>
        <!--[if lt IE 9]>
            <script src="http://blog.dornea.nu/theme/js/html5shiv.js"></script>
            <script src="http://blog.dornea.nu/theme/js/respond.min.js"></script>
        <![endif]-->
    </head>
    <body> 
        <div id="body-header">
            <div class="navbar navbar-inverse navbar-fixed-top">
                <div class="col-md-12">
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                        <a class="navbar-brand" href="http://blog.dornea.nu">
                            <i class="icon-home"></i>blog.dornea.nu
                        </a>
                    </div>
                    <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
                        <ul class="nav navbar-nav">
                            <li><a href="http://dornea.nu" title="about">
                                <i class="icon-user"></i>about</a>
                            </li>
                            <li><a href="/archives.html" title="archives">
                                <i class="icon-archive"></i>archives</a>
                            </li>
                            <li><a href="/tags.html" title="tags">
                                <i class="icon-tag"></i>tags</a>
                            </li>
                            <li><a href="/feeds/rss.xml" title="feeds">
                                <i class="icon-rss"></i>feeds</a>
                            </li>
                        <!-- category dropdown list -->
                        <li class="dropdown">
                           <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                <i class="icon-folder-open"></i>category<b class="caret"></b>
                           </a>
                           <ul class="dropdown-menu">
                               <li><a href="http://blog.dornea.nu/category/blog">
                                      <i class="icon-pencil"></i>blog
                                      (154)</a></li>
                               <li><a href="http://blog.dornea.nu/category/notes">
                                      <i class="icon-book"></i>notes
                                      (8)</a></li>
                           </ul>
                        </li>
                        <!--  self defined dropdown list -->
                        </ul>
                        
                        <!-- right nav bar -->
                        <ul class="nav navbar-nav navbar-right">
                        <!-- google custom search -->
                        <li>
                        <div id="niu2-cse-wrapper">
                            <div id="niu2-cse-header-box" class="navbar-form navbar-nav">
                                <form action="http://google.com/cse">
                                    <input type="hidden" name="cx" value="008508447409818574933:pxyxuhrgnxi" />
                                    <input type="hidden" name="ie" value="UTF-8" />
                                    <div class="form-group">
                                        <input id="niu2-cse-search-input" class="niu2-cse-header form-control" 
                                            type="text" name="q" 
                                            placeholder="Press enter to search ..."/>
                                    </div>
                                </form>
                           </div>
                           <div id="niu2-cse-ctrl-box" class="navbar-nav">
                            <i id="niu2-cse-search-image" class="icon-search navbar-nav"></i><span id="niu2-cse-search-text">Search</span>
                           </div>
                       </div>
                       </li>
                       </ul>
                    </nav>
                </div>

            </div>
            <!-- End navbar -->
            <!-- Banner -->
<style>
    #banner{
        background-image:url("http://blog.dornea.nu//images/header.jpg");
    }   
</style>

<div id="banner">
    <div class="container">
        <div class="copy">
            <h2>blog.dornea.nu</h2>
                <p class="intro">Hack, code and drink some țuică. Personal blog of Victor Dorneanu.</p>
        </div>
    </div>
</div>
            <!-- End Banner -->
        </div>

        <div id="body-content">
            <div class="col-md-8 col-md-offset-2">
                <h1 id="content-heading">HowTo: Put nginx and PHP to jail in Debian 8</h1>
            </div>
            <div id="niu2-left-container" class="col-md-6 col-md-offset-2 with-right-border">
                <div id="niu2-main-content">
                    <p>Although I thought this would be an easy task, it turned out that <strong>chrooting</strong> daemons takes more than copying config files and libraries. There are donzens of tutorials out there how to do it, but the devil lies in detail - as always. Setting up a chroot environment is easy. But securing it properly is prone to faults which in worst case could let an attacker escape the chroot. And this is your worst nightmare, right? So let's have a look at some more technical details.</p>
<p>For those unfamiliar with <code>chroot</code> make sure you have a look at least the <a href="https://en.wikipedia.org/wiki/Chroot">Wikipedia entry</a>.  There are also soms <a href="http://www.unixwiz.net/techtips/chroot-practices.html">chroot best practices</a> you could have a look at. Although there are better alternatives solving this job (e.g. docker) and being unable to load <strong>LSM</strong> (<a href="https://en.wikipedia.org/wiki/Linux_Security_Modules">Linux Security Modules</a>) on a vServer, putting a daemon to <em>jails</em> seems to be a pretty good approach. But there are several things one should keep in mind since <code>chroot</code> isn't a security feature per se (make sure you read <a href="https://securityblog.redhat.com/2013/03/27/is-chroot-a-security-feature/">"Is chroot a security feature?"</a> and <a href="https://lwn.net/Articles/252794/">"What chroot() is really for"</a>).</p>
<h2 id="e3c83dc69b8ec2685283f5e756c2d39f">Before starting</h2>
<p>All the shell commands below are part of a <code>bash</code> script I use to setup a secure chroot. Use this <a href="https://gist.github.com/dorneanu/9f940b2ded9c05b5be9f">gist</a> to download the script files:</p>
<ul>
<li><a href="https://gist.github.com/dorneanu/9f940b2ded9c05b5be9f#file-chroot-sh">chroot.sh</a></li>
<li><a href="https://gist.github.com/dorneanu/9f940b2ded9c05b5be9f#file-n2chroot">n2chroot</a></li>
<li><a href="https://gist.github.com/dorneanu/9f940b2ded9c05b5be9f#file-nginx-chroot">nginx-chroot</a> (to copy to <code>/etc/init.d/*</code>)</li>
<li><a href="https://gist.github.com/dorneanu/9f940b2ded9c05b5be9f#file-php5-fpm-chroot">php5-fpm-chroot</a> (to copy to <code>/etc/init.d/*</code>)</li>
</ul>
<p>Make sure you <strong>edit</strong> the files and adapt <code>BASE</code> to your <strong>chroot path</strong> (in my scripts: <code>/var/www/chroot</code>).</p>
<h2 id="599b4d13ba5c488955fc5ce046374e07">Unleash the daemons</h2>
<p>Nowadays hosting a typical PHP application is  pretty straight-forward. Several components are necesarry:</p>
<ul>
<li>web server (<code>nginx</code>) hosting the application</li>
<li>application (<code>PHP</code>)</li>
<li>data base (<code>mysqld</code>) for storing information</li>
</ul>
<p>The <code>mysqld</code> will usually listen on <em>localhost:3306</em> and can be thus accessed by the processes inside the chroot as well. The <code>nginx</code> and the <code>PHP</code> daemons have some dependencies to be installed inside the chroot otherwise you won't be able to run them. For the sake of example let's have a look at <code>nginx</code>:</p>
<div class="highlight"><pre><span class="nv">$ </span>ldd /usr/sbin/nginx
    linux-vdso.so.1 <span class="o">(</span>0x00007fffe734d000<span class="o">)</span>
    libpthread.so.0 <span class="o">=</span>&gt; /lib/x86_64-linux-gnu/libpthread.so.0 <span class="o">(</span>0x00007f47b5548000<span class="o">)</span>
    libcrypt.so.1 <span class="o">=</span>&gt; /lib/x86_64-linux-gnu/libcrypt.so.1 <span class="o">(</span>0x00007f47b5311000<span class="o">)</span>
    libpam.so.0 <span class="o">=</span>&gt; /lib/x86_64-linux-gnu/libpam.so.0 <span class="o">(</span>0x00007f47b5101000<span class="o">)</span>
    libexpat.so.1 <span class="o">=</span>&gt; /lib/x86_64-linux-gnu/libexpat.so.1 <span class="o">(</span>0x00007f47b4ed8000<span class="o">)</span>
    libpcre.so.3 <span class="o">=</span>&gt; /lib/x86_64-linux-gnu/libpcre.so.3 <span class="o">(</span>0x00007f47b4c6a000<span class="o">)</span>
    libssl.so.1.0.0 <span class="o">=</span>&gt; /usr/lib/x86_64-linux-gnu/libssl.so.1.0.0 <span class="o">(</span>0x00007f47b4a09000<span class="o">)</span>
    libcrypto.so.1.0.0 <span class="o">=</span>&gt; /usr/lib/x86_64-linux-gnu/libcrypto.so.1.0.0 <span class="o">(</span>0x00007f47b460e000<span class="o">)</span>
<span class="o">[</span>...<span class="o">]</span>
</pre></div>
<p>So there are a lot of libraries which have to be copied into the chroot in order for the <code>nginx</code> binary to execute properly. But first, let's setup the basic directory structure.</p>
<h2 id="1d00661db2f4476774808e059a90a7e7">chroot() environment</h2>
<p>First we'll create the basic directory structure and copy some basic stuff to it:</p>
<div class="highlight"><pre><span class="c"># Create devices</span>
<span class="nv">$ </span>mkdir <span class="nv">$JAIL</span>/dev
<span class="nv">$ </span>mknod -m <span class="m">0666</span> <span class="nv">$JAIL</span>/dev/null c <span class="m">1</span> 3
<span class="nv">$ </span>mknod -m <span class="m">0666</span> <span class="nv">$JAIL</span>/dev/random c <span class="m">1</span> 8
<span class="nv">$ </span>mknod -m <span class="m">0444</span> <span class="nv">$JAIL</span>/dev/urandom c <span class="m">1</span> 9

<span class="c"># Create directories</span>
<span class="nv">$ </span>mkdir -p <span class="nv">$JAIL</span>/<span class="o">{</span>etc,bin,usr,var<span class="o">}</span>
<span class="nv">$ </span>mkdir -p <span class="nv">$JAIL</span>/usr/<span class="o">{</span>lib,sbin,bin<span class="o">}</span>
<span class="nv">$ </span>mkdir -p <span class="nv">$JAIL</span>/<span class="o">{</span>run,tmp<span class="o">}</span>
<span class="nv">$ </span>mkdir -p <span class="nv">$JAIL</span>/var/run

<span class="c"># Check if 64-bit system</span>
<span class="nv">$ </span><span class="k">if</span> <span class="o">[</span> <span class="k">$(</span>uname -m<span class="k">)</span> <span class="o">=</span> <span class="s2">"x86_64"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nb">cd</span> <span class="nv">$JAIL</span><span class="p">;</span> ln -s usr/lib lib64
    <span class="nb">cd</span> <span class="nv">$JAIL</span>/usr<span class="p">;</span> ln -s lib lib64
<span class="k">else</span>
    <span class="nb">cd</span> <span class="nv">$JAIL</span><span class="p">;</span> ln -s usr/lib lib
<span class="k">fi</span>

<span class="c"># Copy important stuff</span>
<span class="nv">$ </span>cp -rfvL /etc/<span class="o">{</span>services,localtime,nsswitch.conf,nscd.conf,protocols,hosts,ld.so.cache,ld.so.conf,resolv.conf,host.conf<span class="o">}</span> <span class="nv">$JAIL</span>/etc
</pre></div>
<h2 id="ee434023cf89d7dfb21f63d64f0f9d74">nginx</h2>
<p>Next we'll setup <code>nginx</code> and copy necessary config files and libraries:</p>
<div class="highlight"><pre><span class="c"># Create directories</span>
<span class="nv">$ </span>mkdir -p <span class="nv">$JAIL</span>/usr/share/nginx
<span class="nv">$ </span>mkdir -p <span class="nv">$JAIL</span>/var/<span class="o">{</span>log,lib<span class="o">}</span>/nginx
<span class="nv">$ </span>mkdir -p <span class="nv">$JAIL</span>/www/cgi-bin

<span class="c"># Copy files</span>
<span class="nv">$ </span>cp -r /usr/share/nginx/* <span class="nv">$JAIL</span>/usr/share/nginx
<span class="nv">$ </span>cp /usr/sbin/nginx <span class="nv">$JAIL</span>/usr/sbin/
<span class="nv">$ </span>cp -r /var/lib/nginx <span class="nv">$JAIL</span>/var/lib/nginx

<span class="c"># Copy libraries</span>
<span class="nv">$ </span><span class="si">${</span><span class="nv">N2CHROOT</span><span class="si">}</span> /usr/sbin/nginx

<span class="c"># Copy config files and other important stuff</span>
<span class="nv">$ </span>cp -rfvL /etc/nginx <span class="nv">$JAIL</span>/etc

<span class="c"># Create PID file</span>
<span class="nv">$ </span>touch <span class="nv">$JAIL</span>/run/nginx.pid

<span class="c"># Copy the nginx binary</span>
<span class="nv">$ </span>cp /usr/sbin/nginx <span class="nv">$JAIL</span>/usr/sbin/
</pre></div>
<h3 id="231cf4c70d866b616c21baddaeed0696">Troubleshooting</h3>
<p>First let's see if we can run the daemon at all:</p>
<div class="highlight"><pre><span class="nv">$ </span>/usr/sbin/chroot <span class="nv">$JAIL</span> /usr/sbin/nginx -t                
nginx: <span class="o">[</span>emerg<span class="o">]</span> getpwnam<span class="o">(</span><span class="s2">"www-data"</span><span class="o">)</span> failed in /etc/nginx/nginx.conf:1
nginx: configuration file /etc/nginx/nginx.conf <span class="nb">test </span>failed
</pre></div>
<p>OK. Let's have a look at <code>strace</code>:</p>
<div class="highlight"><pre>mmap<span class="o">(</span>NULL, 39842, PROT_READ, MAP_PRIVATE, 5, 0<span class="o">)</span> <span class="o">=</span> 0x7f1d0c620000
close<span class="o">(</span>5<span class="o">)</span>                                <span class="o">=</span> 0
access<span class="o">(</span><span class="s2">"/etc/ld.so.nohwcap"</span>, F_OK<span class="o">)</span>      <span class="o">=</span> -1 ENOENT <span class="o">(</span>No such file or directory<span class="o">)</span>
open<span class="o">(</span><span class="s2">"/lib/x86_64-linux-gnu/libnss_compat.so.2"</span>, O_RDONLY<span class="p">|</span>O_CLOEXEC<span class="o">)</span> <span class="o">=</span> -1 ENOENT <span class="o">(</span>No such file or directory<span class="o">)</span>
...
exit_group<span class="o">(</span>1<span class="o">)</span>                           <span class="o">=</span> ?
+++ exited with <span class="m">1</span> +++
</pre></div>
<p>Apparently <code>libnss</code> can't be found. Let's fix that:</p>
<div class="highlight"><pre><span class="nv">$ </span>find / -name <span class="s2">"libnss*"</span>
/lib/x86_64-linux-gnu/libnss_nis-2.19.so
/lib/x86_64-linux-gnu/libnss_compat-2.19.so
/lib/x86_64-linux-gnu/libnss_compat.so.2
/lib/x86_64-linux-gnu/libnss_nisplus.so.2
/lib/x86_64-linux-gnu/libnss_nis.so.2
/lib/x86_64-linux-gnu/libnss_files.so.2
/lib/x86_64-linux-gnu/libnss_dns.so.2
/lib/x86_64-linux-gnu/libnss_files-2.19.so
/lib/x86_64-linux-gnu/libnss_hesiod.so.2
/lib/x86_64-linux-gnu/libnss_nisplus-2.19.so
/lib/x86_64-linux-gnu/libnss_hesiod-2.19.so
/lib/x86_64-linux-gnu/libnss_dns-2.19.so
/usr/lib/x86_64-linux-gnu/libnss_nisplus.so
/usr/lib/x86_64-linux-gnu/libnss_hesiod.so
/usr/lib/x86_64-linux-gnu/libnss_compat.so
/usr/lib/x86_64-linux-gnu/libnss_files.so
/usr/lib/x86_64-linux-gnu/libnss_dns.so
/usr/lib/x86_64-linux-gnu/libnss_nis.so

<span class="c"># cp /lib/x86_64-linux-gnu/libnss_* $JAIL/lib/x86_64-linux-gnu/</span>
</pre></div>
<p>Let's give it a 2nd try:</p>
<div class="highlight"><pre><span class="nv">$ </span>/usr/sbin/chroot <span class="nv">$JAIL</span> /usr/sbin/nginx -t
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf <span class="nb">test </span>is successful
</pre></div>
<h2 id="c19305666bf2b95b6e2a0d835dc87ddb">php5-fpm</h2>
<p>The PHP FastCGI Process Manager (<code>php5-fpm</code>) also requires some libraries and config files that have to be available in the new <code>chroot</code>:</p>
<div class="highlight"><pre><span class="c"># Copy config files</span>
<span class="nv">$ </span>cp -rfvl /etc/php5 <span class="nv">$JAIL</span>/etc/
<span class="nv">$ </span>cp -rfvl /usr/share/zoneinfo <span class="nv">$JAIL</span>/usr/share/

<span class="c"># Copy libraries</span>
<span class="nv">$ </span><span class="si">${</span><span class="nv">N2CHROOT</span><span class="si">}</span> /usr/sbin/php5-fpm

<span class="c"># Copy the php5-fpm binary</span>
<span class="nv">$ </span>cp /usr/sbin/php5-fpm <span class="nv">$JAIL</span>/usr/sbin/
</pre></div>
<p>Let's check if everything is ok:</p>
<div class="highlight"><pre><span class="nv">$ </span>/usr/sbin/chroot <span class="nv">$JAIL</span> /usr/sbin/php5-fpm --help
Failed loading /usr/lib/php5/20131226/opcache.so:  /usr/lib/php5/20131226/opcache.so: cannot open shared object file: No such file or directory
<span class="o">[</span>11-Jan-2016 19:46:19<span class="o">]</span> NOTICE: PHP message: PHP Warning:  PHP Startup: Unable to load dynamic library <span class="s1">'/usr/lib/php5/20131226/mysqlnd.so'</span> - /usr/lib/php5/20131226/mysqlnd.so: cannot open shared object file: No such file or directory in Unknown on line 0
<span class="o">[</span>11-Jan-2016 19:46:19<span class="o">]</span> NOTICE: PHP message: PHP Warning:  PHP Startup: Unable to load dynamic library <span class="s1">'/usr/lib/php5/20131226/pdo.so'</span> - /usr/lib/php5/20131226/pdo.so: cannot open shared object file: No such file or directory in Unknown on line 0
<span class="o">[</span>11-Jan-2016 19:46:19<span class="o">]</span> NOTICE: PHP message: PHP Warning:  PHP Startup: Unable to load dynamic library <span class="s1">'/usr/lib/php5/20131226/curl.so'</span> - /usr/lib/php5/20131226/curl.so: cannot open shared object file: No such file or directory in ...
</pre></div>
<p>Obviously some libraries are still missing. Let's fix that:</p>
<div class="highlight"><pre><span class="nv">$ </span>cp -rvfl /usr/lib/php5 <span class="nv">$JAIL</span>/usr/lib
<span class="nv">$ </span><span class="k">for</span> f in /usr/lib/php5/20131226/*.so<span class="p">;</span> <span class="k">do</span>
&gt;    n2chroot <span class="nv">$f</span>
&gt; <span class="k">done</span>
</pre></div>
<p>The <code>for</code>-loop will look at every php-module and copy its dependant libraries to the chroot. </p>
<h3 id="7d142f7e874f872f01475d5056a8e198">Can't execute exec(), shell_exec() or system()</h3>
<p>If you experience some sort of problems like <a href="http://stackoverflow.com/questions/17006136/exec-with-php-fpm-on-nginx-under-chroot-returns-nothing">this</a> you probably have no <code>/bin/sh</code> inside your chroot (which is great after all, since we want to strip down the environment to a minimal setup). However <strong>PHP</strong>'s functions like <code>exec()</code>, <code>shell_exec()</code> or <code>system()</code>will internally call <code>/bin/sh -c</code> to run the commands. So if your PHP application is using something like <code>sendmail</code> and you don't want to install any shell into your chroot, I've found this <a href="https://knzl.de/setting-up-a-chroot-for-php/">solution</a> from <em>Sebastian Kienzl</em> which basically consists in providing a "shell" which will in turn use <code>execvp()</code> to run commands. </p>
<div class="highlight"><pre><span class="cp">#include &lt;stdio.h&gt;</span>
<span class="cp">#include &lt;stdlib.h&gt;</span>
<span class="cp">#include &lt;string.h&gt;</span>
<span class="cp">#include &lt;unistd.h&gt;</span>

<span class="cp">#define MAXARG 64</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span> <span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="k">const</span> <span class="n">argv</span><span class="p">[]</span> <span class="p">)</span> <span class="p">{</span>
    <span class="kt">char</span><span class="o">*</span> <span class="n">args</span><span class="p">[</span> <span class="n">MAXARG</span> <span class="p">]</span> <span class="o">=</span> <span class="p">{};</span>

    <span class="k">if</span><span class="p">(</span> <span class="n">argc</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="o">||</span> <span class="n">strcmp</span><span class="p">(</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s">"-c"</span> <span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
        <span class="n">fprintf</span><span class="p">(</span> <span class="n">stderr</span><span class="p">,</span> <span class="s">"Usage: %s -c &lt;cmd&gt;</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">);</span>  
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="p">{</span>
        <span class="kt">char</span><span class="o">*</span> <span class="n">token</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>  
        <span class="kt">char</span><span class="o">*</span> <span class="n">argStr</span> <span class="o">=</span> <span class="n">strdup</span><span class="p">(</span> <span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="p">);</span>
        <span class="k">while</span><span class="p">(</span> <span class="p">(</span> <span class="n">token</span> <span class="o">=</span> <span class="n">strsep</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">argStr</span><span class="p">,</span> <span class="s">" "</span> <span class="p">)</span> <span class="p">)</span> <span class="o">!=</span> <span class="nb">NULL</span> <span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">token</span> <span class="o">&amp;&amp;</span> <span class="n">strlen</span><span class="p">(</span> <span class="n">token</span> <span class="p">)</span> <span class="p">)</span>
                <span class="n">args</span><span class="p">[</span> <span class="n">i</span><span class="o">++</span> <span class="p">]</span> <span class="o">=</span> <span class="n">token</span><span class="p">;</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">MAXARG</span> <span class="p">)</span>
                <span class="k">return</span> <span class="mi">2</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>  

    <span class="k">return</span> <span class="n">execvp</span><span class="p">(</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">args</span> <span class="p">);</span>
<span class="p">}</span>
</pre></div>
<p>Compile this using (I use <code>clang</code>):</p>
<div class="highlight"><pre><span class="nv">$ </span>clang -O2 -fpie -pie -Wformat -Wformat-security -Werror<span class="o">=</span>format-security -D_FORTIFY_SOURCE<span class="o">=</span><span class="m">2</span> <span class="se">\</span>
  sh.c -o sh
</pre></div>
<p>Now remove the sources and strip the binary:</p>
<div class="highlight"><pre><span class="nv">$ </span>rm sh.c
<span class="nv">$ </span>strip sh
</pre></div>
<p>However this approach seemed to introduce more problems than it was a decent solution. Depending on the applications and the scope you can decide whether to use a wrapper or provide <code>/bin/sh</code> inside your chroot. Nevertheless there should be no <code>setuid</code> binaries. More on that later.</p>
<h3 id="75bc13296f6d458b7d5ea5c1bb0570f5">Timezone is corrupt</h3>
<p>If you have issues like:</p>
<div class="highlight"><pre>PHP message: PHP Fatal error:  date<span class="o">()</span>: Timezone database is corrupt - this should *never* happen!
</pre></div>
<p>or </p>
<div class="highlight"><pre>PHP message: PHP Notice:  date_default_timezone_set<span class="o">()</span>: Timezone ID <span class="s1">'UTC'</span> is invalid
</pre></div>
<p>make sure you copy <code>/usr/share/zoneinfo</code> into the chroot:</p>
<div class="highlight"><pre><span class="nv">$ </span>cp -Rv /usr/share/zoneinfo <span class="nv">$JAIL</span>/usr/share/
</pre></div>
<h2 id="f78fe3a008a0daeaf7c7b41476dada71">Adjust chroot() security</h2>
<p>In fact the actual hardening of the environment has not taken place already. Many people have pointed out that <strong>chroot != security</strong> and additional steps are vital for not being able to <strong>unchroot</strong> inside it. A few years ago <a href="https://filippo.io/escaping-a-chroot-jail-slash-1/">Filippo</a> also showed how easy an attacker could achieve that if specific conditions were satisfied. Since <code>chroot()</code> in my opinion it not <strong>THE</strong> security feature I'd say it's sort of <strong>security in depth</strong>. Although there are enough cases where  leaving the chroot is possible - if securing it hasn't been done correctly, some recommendations from <a href="http://talby.rcs.manchester.ac.uk/~isd/_unix_security/unix_security_intro_securing_network_services.Breaking_Out_of_and_Securing_Chroot_Jails.html">here</a> should be taken into consideration:</p>
<ul>
<li><strong>not</strong> run daemons as <strong>root</strong></li>
<li>avoid <strong>setuid</strong> executables</li>
<li>ensure root (<strong>UID 0</strong>) does not even exist within the jail</li>
<li>avoid unnecessary bullshit and only install the minimum inside the jail</li>
</ul>
<p>Let's translate those into commands:</p>
<div class="highlight"><pre><span class="c"># Add users</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"www-data:x:1337:1337:www-data:/:/bin/false"</span> &gt;&gt; <span class="nv">$JAIL</span>/etc/passwd
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"nobody:x:99:99:nobody:/:/bin/false"</span> &gt;&gt; <span class="nv">$JAIL</span>/etc/passwd

<span class="c"># Add groups</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"www-data:x:1337:"</span> &gt;&gt; <span class="nv">$JAIL</span>/etc/group
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"nobody:x:99:"</span> &gt;&gt; <span class="nv">$JAIL</span>/etc/group

<span class="c"># Add shadow</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"www-data:x:14871::::::"</span> &gt;&gt; <span class="nv">$JAIL</span>/etc/shadow
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"nobody:x:14871::::::"</span> &gt;&gt; <span class="nv">$JAIL</span>/etc/shadow

<span class="c"># Add gshadow</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"www-data:::"</span> &gt;&gt; <span class="nv">$JAIL</span>/etc/gshadow
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"nobody:::"</span> &gt;&gt; <span class="nv">$JAIL</span>/etc/gshadow

<span class="c"># Set ownerships</span>
<span class="nv">$ </span>chown -R root:root <span class="nv">$JAIL</span>/
<span class="nv">$ </span>chown -R www-data:www-data <span class="nv">$JAIL</span>/www
<span class="nv">$ </span>chown -R www-data:www-data <span class="nv">$JAIL</span>/etc/<span class="o">{</span>nginx,php5<span class="o">}</span>
<span class="nv">$ </span>chown -R www-data:www-data <span class="nv">$JAIL</span>/var/<span class="o">{</span>log,lib<span class="o">}</span>/nginx
<span class="nv">$ </span>chown www-data:www-data <span class="nv">$JAIL</span>/run/nginx.pid

<span class="c"># Restrict permissions</span>
<span class="nv">$ </span>find <span class="nv">$JAIL</span>/ -gid <span class="m">0</span> -uid <span class="m">0</span> -type d -print <span class="p">|</span> xargs chmod -rw
<span class="nv">$ </span>find <span class="nv">$JAIL</span>/ -gid <span class="m">0</span> -uid <span class="m">0</span> -type d -print <span class="p">|</span> xargs chmod +x
<span class="nv">$ </span>find <span class="nv">$JAIL</span>/etc -gid <span class="m">0</span> -uid <span class="m">0</span> -type f -print <span class="p">|</span> xargs chmod -x
<span class="nv">$ </span>find <span class="nv">$JAIL</span>/usr/sbin -type f -print <span class="p">|</span> xargs chmod ug+rx
<span class="nv">$ </span>find <span class="nv">$JAIL</span>/ -group www-data -user www-data -print <span class="p">|</span> xargs chmod o-rwx
<span class="nv">$ </span>chmod +rw <span class="nv">$JAIL</span>/tmp
<span class="nv">$ </span>chmod +rw <span class="nv">$JAIL</span>/run
</pre></div>
<h2 id="2245b39c177e93fc015ba051be4e8574">systemd</h2>
<p>Since <code>systemd</code>is now everywhere you can define your own <strong>service</strong> to start the daemons.</p>
<h3 id="ee434023cf89d7dfb21f63d64f0f9d74_1">nginx</h3>
<div class="highlight"><pre><span class="nv">$ </span>sudo cat /etc/systemd/system/multi-user.target.wants/nginx.service 
<span class="c"># Stop dance for nginx</span>
<span class="c"># =======================</span>
<span class="c">#</span>
<span class="c"># ExecStop sends SIGSTOP (graceful stop) to the nginx process.</span>
<span class="c"># If, after 5s (--retry QUIT/5) nginx is still running, systemd takes control</span>
<span class="c"># and sends SIGTERM (fast shutdown) to the main process.</span>
<span class="c"># After another 5s (TimeoutStopSec=5), and if nginx is alive, systemd sends</span>
<span class="c"># SIGKILL to all the remaining processes in the process group (KillMode=mixed).</span>
<span class="c">#</span>
<span class="c"># nginx signals reference doc:</span>
<span class="c"># http://nginx.org/en/docs/control.html</span>
<span class="c">#</span>
<span class="o">[</span>Unit<span class="o">]</span>
<span class="nv">Description</span><span class="o">=</span>nginx <span class="o">(</span>Chroot<span class="o">)</span>
<span class="nv">After</span><span class="o">=</span>network.target

<span class="o">[</span>Service<span class="o">]</span>
<span class="nv">Type</span><span class="o">=</span>forking
<span class="nv">PIDFile</span><span class="o">=</span>/var/www/chroot/run/nginx.pid
<span class="nv">RootDirectory</span><span class="o">=</span>/var/www/chroot
<span class="nv">ExecStartPre</span><span class="o">=</span>/usr/sbin/nginx -t -c /etc/nginx/nginx.conf
<span class="nv">ExecStart</span><span class="o">=</span>/usr/sbin/nginx -c /etc/nginx/nginx.conf
<span class="nv">ExecReload</span><span class="o">=</span>/usr/sbin/nginx -c /etc/nginx/nginx.conf -s reload
<span class="nv">ExecStop</span><span class="o">=</span>/usr/sbin/nginx -c /etc/nginx/nginx.conf -s stop
<span class="nv">TimeoutStopSec</span><span class="o">=</span>5
<span class="nv">KillMode</span><span class="o">=</span>mixed

<span class="o">[</span>Install<span class="o">]</span>
<span class="nv">WantedBy</span><span class="o">=</span>multi-user.target
</pre></div>
<p>Now run it:</p>
<div class="highlight"><pre><span class="nv">$ </span>sudo service nginx start
<span class="nv">$ </span>ps -ax <span class="p">|</span> grep nginx
<span class="m">28530</span> ?        Ss     0:00 nginx: master process /usr/sbin/nginx -c /etc/nginx/nginx.conf
<span class="m">28531</span> ?        S      0:00 nginx: worker process
<span class="m">28613</span> pts/0    S+     0:00 grep nginx
<span class="nv">$ </span>ls -l /proc/28530/root
sudo ls -l /proc/28530/root
lrwxrwxrwx <span class="m">1</span> root root <span class="m">0</span> Jan <span class="m">12</span> 21:31 /proc/28530/root -&gt; /var/www/chroot
</pre></div>
<p>If you don't want to use <code>systemd</code> you can use following to start/stop <code>nginx</code>:</p>
<div class="highlight"><pre><span class="nv">$ </span>chroot <span class="nv">$JAIL</span> /usr/sbin/nginx
<span class="nv">$ </span>pgrep nginx <span class="p">|</span> xargs <span class="nb">kill</span> -9
</pre></div>
<h3 id="c19305666bf2b95b6e2a0d835dc87ddb_1">php5-fpm</h3>
<p>The same applies to <code>php5-fpm</code> too:</p>
<div class="highlight"><pre><span class="nv">$ </span>cat /etc/systemd/system/multi-user.target.wants/php5-fpm.service
<span class="o">[</span>Unit<span class="o">]</span>
<span class="nv">Description</span><span class="o">=</span>The PHP FastCGI Process Manager
<span class="nv">After</span><span class="o">=</span>network.target

<span class="o">[</span>Service<span class="o">]</span> 
<span class="nv">Type</span><span class="o">=</span>notify
<span class="nv">PIDFile</span><span class="o">=</span>/var/run/php5-fpm.pid
<span class="nv">ExecStartPre</span><span class="o">=</span>/usr/xbin/php5 -t
<span class="nv">ExecStart</span><span class="o">=</span>/usr/sbin/php5-fpm --daemonize --fpm-config /etc/php5/fpm/php-fpm.conf
<span class="nv">ExecReload</span><span class="o">=</span>/bin/kill -USR2 <span class="nv">$MAINPID</span>

<span class="o">[</span>Install<span class="o">]</span>
<span class="nv">WantedBy</span><span class="o">=</span>multi-user.target
</pre></div>
<p>or start it manually:</p>
<div class="highlight"><pre><span class="nv">$ </span>chroot <span class="nv">$JAIL</span> /usr/sbin/php5-fpm --daemonize --fpm-config /etc/php5/fpm/php-fpm.conf
<span class="nv">$ </span>pgrep php <span class="p">|</span> xargs <span class="nb">kill</span> -9
</pre></div>
<p>Check if it's indeed running in the chroot:</p>
<div class="highlight"><pre><span class="nv">$ </span>ps -ax <span class="p">|</span>grep fpm
 <span class="m">9468</span> ?        Ss     0:00 php-fpm: master process <span class="o">(</span>/etc/php5/fpm/php-fpm.conf<span class="o">)</span>
 <span class="m">9469</span> ?        S      0:00 php-fpm: pool www
 <span class="m">9470</span> ?        S      0:00 php-fpm: pool www

<span class="nv">$ </span>ls -l /proc/9468/root
lrwxrwxrwx <span class="m">1</span> root root <span class="m">0</span> Jan <span class="m">13</span> 18:04 /proc/9468/root -&gt; /var/www/chroot
</pre></div>
<h2 id="e4027889f79dedee9ff688ed9ddfa97d">System V</h2>
<p>If you don't like <code>systemd</code> you can still do it the old way and have your scripts at <code>/etc/init.d/*</code>. </p>
<h3 id="ee434023cf89d7dfb21f63d64f0f9d74_1_2">nginx</h3>
<div class="highlight"><pre><span class="nv">$ </span>cat /etc/init.d/nginx-chroot 
<span class="c">#!/bin/sh</span>

<span class="c">### BEGIN INIT INFO</span>
<span class="c"># Provides:          nginx-chroot</span>
<span class="c"># Required-Start:    </span>
<span class="c"># Required-Stop:</span>
<span class="c"># Default-Start:     2 3 4 5</span>
<span class="c"># Default-Stop:      0 1 6</span>
<span class="c"># Short-Description: Start nginx in a chroot</span>
<span class="c">### END INIT INFO</span>

<span class="nv">CHROOT</span><span class="o">=</span>/var/www/chroot

<span class="k">case</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> in
  start<span class="o">)</span>
        /usr/sbin/chroot <span class="nv">$CHROOT</span> /usr/sbin/nginx -q -g <span class="s1">'daemon on; master_process on;'</span>
        <span class="p">;;</span>  
  reload<span class="o">)</span>
        /usr/sbin/chroot <span class="nv">$CHROOT</span> /usr/sbin/nginx -g <span class="s1">'daemon on; master_process on;'</span> -s reload
        <span class="p">;;</span>
  stop<span class="o">)</span> 
        pgrep nginx <span class="p">|</span> xargs <span class="nb">kill</span> -9  
        <span class="p">;;</span> 
  *<span class="o">)</span>
        <span class="nb">echo</span> <span class="s2">"Usage: </span><span class="nv">$N</span><span class="s2"> {start|reload|stop}"</span> &gt;<span class="p">&amp;</span>2
        <span class="nb">exit </span>1
        <span class="p">;;</span>
<span class="k">esac</span>

<span class="nb">exit </span>0
</pre></div>
<h3 id="c19305666bf2b95b6e2a0d835dc87ddb_1_2">php5-fpm</h3>
<div class="highlight"><pre><span class="nv">$ </span>cat /etc/init.d/php5-fpm-chroot 
<span class="c">#!/bin/sh</span>

<span class="c">### BEGIN INIT INFO</span>
<span class="c"># Provides:          php5-fpm-chroot</span>
<span class="c"># Required-Start:    </span>
<span class="c"># Required-Stop:</span>
<span class="c"># Default-Start:     2 3 4 5</span>
<span class="c"># Default-Stop:      0 1 6</span>
<span class="c"># Short-Description: Start php5-fpm in a chroot</span>
<span class="c">### END INIT INFO</span>

<span class="nv">CHROOT</span><span class="o">=</span>/var/www/chroot

<span class="k">case</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> in
  start<span class="o">)</span>
        /usr/sbin/chroot <span class="nv">$CHROOT</span> /usr/sbin/php5-fpm --daemonize --fpm-config /etc/php5/fpm/php-fpm.conf
        <span class="p">;;</span>  
  stop<span class="o">)</span> 
        pgrep php <span class="p">|</span> xargs <span class="nb">kill</span> -9  
        <span class="p">;;</span> 
  *<span class="o">)</span>
        <span class="nb">echo</span> <span class="s2">"Usage: </span><span class="nv">$N</span><span class="s2"> {start|stop}"</span> &gt;<span class="p">&amp;</span>2
        <span class="nb">exit </span>1
        <span class="p">;;</span>
<span class="k">esac</span>

<span class="nb">exit </span>0
</pre></div>
<h3 id="807d6c5cc3acb6d61dbe7c80f43ba3cf">Install new services</h3>
<p>First of all make sure you <strong>remove</strong> the old ones:</p>
<div class="highlight"><pre><span class="nv">$ </span>update-rc.d nginx remove
<span class="nv">$ </span>update-rc.d php5-fpm remove
</pre></div>
<p>Now <strong>add</strong> the <strong>new</strong> ones:</p>
<div class="highlight"><pre><span class="nv">$ </span>update-rc.d nginx-chroot defaults
<span class="nv">$ </span>update-rc.d php5-fpm-chroot defaults
</pre></div>
<h2 id="6f8b794f3246b0c1e1780bb4d4d5dc53">Conclusion</h2>
<p>Now you have a basic structure to work with. You might want to add more <strong>binaries</strong> to the chroot but keep in mind the implied security concerns. And also try <strong>not</strong> to use symlinks/hardlinks to directories outside the chroot. You can always always override config files in the chroot with backuped one. And to make sure that everything works well, think about using <a href="http://linux.die.net/man/8/auditd">auditd</a> for monitoring file changes inside the chroot. </p>
<h2 id="d95867deadfe690e40f42068d6b59df8">References</h2>
<ul>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-host-multiple-websites-securely-with-nginx-and-php-fpm-on-ubuntu-14-04">Howt multiple websites with nginx and php-fpm</a></li>
<li><a href="https://filippo.io/escaping-a-chroot-jail-slash-1/">Escaping a chroot</a></li>
<li><a href="http://stackoverflow.com/questions/17006136/exec-with-php-fpm-on-nginx-under-chroot-returns-nothing">exec with php-fpm on nginx under chroot</a></li>
<li><a href="https://knzl.de/setting-up-a-chroot-for-php/">Setting up a chroot for php</a></li>
</ul>
                </div>
<hr/>
<div style="float:left;">
	Previous: <a href="http://blog.dornea.nu/2015/11/17/openvpn-for-paranoids" align='left'>
	 OpenVPN for paranoids
	</a>
</div>
<div style="float:right;">
    Next: <a href="http://blog.dornea.nu/2016/01/26/some-words-on-csrf-and-cookies" align='right'>
	 Some words on CSRF and cookies
	</a>
</div>
</p>
                <div id="content-comments">
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = ''; // required: replace example with your forum shortname


            var disqus_config = function () {
                this.language = "";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
				dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

                </div>

            </div>
            <div class="niu2-right-container col-md-2">
                <div id="niu2-sidebar-meta" class="niu2-sidebar">
                    <div class="niu2-sidebar-label"><i class="icon-calendar"></i>Published:</div>
                    <div class="niu2-sidebar-value">2016-01-15 00:00</div>
                    <div class="niu2-sidebar-label"><i class="icon-pencil"></i>category:</div>
                    <div class="niu2-sidebar-value"><a href="http://blog.dornea.nu/category/blog">blog</a></div>
                    <div class="niu2-sidebar-label"><i class="icon-tag"></i>Tag:</div>
                    <div class="niu2-sidebar-inter-value niu2-sidebar-tag"><a href="http://blog.dornea.nu/tag/nginx/">nginx</a><sup>2</sup></div>
                    <div class="niu2-sidebar-inter-value niu2-sidebar-tag"><a href="http://blog.dornea.nu/tag/php/">php</a><sup>1</sup></div>
                    <div class="niu2-sidebar-inter-value niu2-sidebar-tag"><a href="http://blog.dornea.nu/tag/admin/">admin</a><sup>21</sup></div>
                    <div class="niu2-sidebar-inter-value niu2-sidebar-tag"><a href="http://blog.dornea.nu/tag/debian/">debian</a><sup>1</sup></div>
                    <div class="niu2-sidebar-inter-value niu2-sidebar-tag"><a href="http://blog.dornea.nu/tag/chroot/">chroot</a><sup>1</sup></div>
                </div>

                <div id="niu2-sidebar-toc" class="niu2-sidebar" data-status="closed">
                    <div class="niu2-sidebar-label">
                        <i id="niu2-sidebar-toc-ctrl" class="icon-open-tocs"></i>Table of contents
                    </div>
                    <ul id="niu2-sidebar-toc-list">
                        <li><a href="#content-heading">HowTo: Put nginx and PHP to jail in Debian 8</a></li>
                        <li><a href='#e3c83dc69b8ec2685283f5e756c2d39f'>Before starting</a></li><li><a href='#599b4d13ba5c488955fc5ce046374e07'>Unleash the daemons</a></li><li><a href='#1d00661db2f4476774808e059a90a7e7'>chroot() environment</a></li><li><a href='#ee434023cf89d7dfb21f63d64f0f9d74'>nginx</a><ul><li><a href='#231cf4c70d866b616c21baddaeed0696'>Troubleshooting</a></li></ul></li><li><a href='#c19305666bf2b95b6e2a0d835dc87ddb'>php5-fpm</a><ul><li><a href='#7d142f7e874f872f01475d5056a8e198'>Can't execute exec(), shell_exec() or system()</a></li><li><a href='#75bc13296f6d458b7d5ea5c1bb0570f5'>Timezone is corrupt</a></li></ul></li><li><a href='#f78fe3a008a0daeaf7c7b41476dada71'>Adjust chroot() security</a></li><li><a href='#2245b39c177e93fc015ba051be4e8574'>systemd</a><ul><li><a href='#ee434023cf89d7dfb21f63d64f0f9d74_1'>nginx</a></li><li><a href='#c19305666bf2b95b6e2a0d835dc87ddb_1'>php5-fpm</a></li></ul></li><li><a href='#e4027889f79dedee9ff688ed9ddfa97d'>System V</a><ul><li><a href='#ee434023cf89d7dfb21f63d64f0f9d74_1_2'>nginx</a></li><li><a href='#c19305666bf2b95b6e2a0d835dc87ddb_1_2'>php5-fpm</a></li><li><a href='#807d6c5cc3acb6d61dbe7c80f43ba3cf'>Install new services</a></li></ul></li><li><a href='#6f8b794f3246b0c1e1780bb4d4d5dc53'>Conclusion</a></li><li><a href='#d95867deadfe690e40f42068d6b59df8'>References</a></li>
                        <li><a href="#content-comments">Comments</a></li>
                    </ul>
                </div>
            </div>
            <div id="niu2-toolbar">
                <ul class="list-unstyled">
                    <li><a id="niu2-toolbar-ctrlsidebar" href="#" title="Hide Sidebar"><i class="icon-3x icon-hide-sidebar"></i></a></li>
                </ul>
                <div id="niu2-toolbar-showsidebar" data-title="Show Sidebar"></div>
                <div id="niu2-toolbar-github" data-repo=""></div>
                <div id="niu2-toolbar-bitbucket" data-repo=""></div>
            </div>
            <div id="niu2-toc" data-style="fixed"></div>
        </div>

        <div class="niu2-footer">
            <div id="body-footer" class="col-md-6 col-md-offset-2">
                <hr/>
                <p>
                    Powered by <a href="https://github.com/getpelican/pelican">Pelican</a>, 
                    <a href="https://github.com/mawenbao/niu-x2-sidebar">theme</a> built with <a href="https://github.com/twbs/bootstrap">Bootstrap3</a>
                    by <a href="https://blog.mawenbao.com">Ma Wenbao</a>, icons by 
                    <a href="https://fortawesome.github.io/Font-Awesome">Font Awesome</a>.
                </p>
                <p>
                    © 2008 - 2016
                    <a class="niu2-footer-link" href="http://blog.dornea.nu">Victor Dorneanu</a>
                </p>
                <p class="niu2-icons">
                    <a class="niu2-footer-icon" href="https://pgp.mit.edu/pks/lookup?op=get&search=0x18F1AD46FB05E1B7" title="my public key">
                        <i class="icon-key icon-lg"></i>
                    </a>
                    <a class="niu2-footer-icon" href="mailto: no-spam ÄATT dornea DOT nu" title="my email address">
                        <i class="icon-envelope-o icon-lg"></i>
                    </a>
                    <a class="niu2-footer-icon" href="http://github.com/dorneanu" title="my github page">
                        <i class="icon-github-alt icon-lg"></i>
                    </a>
                    <a class="niu2-footer-icon" href="/feeds/rss.xml" title="subscribe my blog">
                        <i class="icon-rss icon-lg"></i>
                    </a>
                </p>
            </div>
        </div>

        <script type="text/javascript">
            var _gaq=_gaq||[];
            _gaq.push(["_setAccount","UA-7161767-3"]);
            _gaq.push(["_trackPageview"]);
            (function(){
                var b=document.createElement("script");
                b.type="text/javascript";
                b.async=true;
                b.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";
                var a=document.getElementsByTagName("script")[0];
                a.parentNode.insertBefore(b,a)
            })();
        </script>
        <div id="niu2-pygments" data-theme="github"></div>
        <div id="niu2-lazy-load" data-loading-txt="Loading image" data-loading-icon="icon-spin icon-spinner"></div>
        <div id="niu2-toolbar-load" data-loading-icon="icon-spin icon-4x icon-spinner"></div>
        <script type="text/javascript" src="http://blog.dornea.nu/theme/js/jquery-1.11.0.min.js"></script>
        <script type="text/javascript" src="http://blog.dornea.nu/theme/js/niu2.min.js"></script>
        <script type="text/javascript" src="http://blog.dornea.nu/theme/js/bootstrap.min.js"></script>
        <script type="text/javascript">
            onContentLoaded();
        </script>
    </body>
</html>