(function(s,i,v){var k=soundManager,j=null,o=null,e=100,m=[],g={},r,h=-1;if("Microsoft Internet Explorer"==navigator.appName){var t=navigator.userAgent,u=/MSIE ([0-9]{1,}[.0-9]{0,})/;null!=u.exec(t)&&(h=parseFloat(RegExp.$1))}else{"Netscape"==navigator.appName&&(t=navigator.userAgent,u=/Trident\/.*rv:([0-9]{1,}[.0-9]{0,})/,null!=u.exec(t)&&(h=parseFloat(RegExp.$1)))}r=h;var p="createTouch" in i||"ontouchstart" in s,q=p?"touchstart":"click",K=p?"touchstart":"mousedown",w=p?"touchmove":"mousemove",x=p?"touchend":"mouseup";k.url=hermit.url;k.debugMode=hermit.debugMode||false;k.debugFlash=hermit.debugFlash||false;k.preferFlash=hermit.preferFlash||(5<r?!0:!1);k.flashVersion=hermit.flashVersion||8;g.init=function(){this.fn.getjson()};g.fn={handleHash:{},bind:i.addEventListener?function(c,b,d){b.addEventListener(c,function(){d.apply(this,arguments);g.fn.handleHash[c]=g.fn.handleHash[c]||[];g.fn.handleHash[c].push(arguments.callee)},!1)}:i.attachEvent?function(c,b,d){b.attachEvent("on"+c,function(){d.apply(this,arguments);g.fn.handleHash[c]=g.fn.handleHash[c]||[];g.fn.handleHash[c].push(arguments.callee)})}:void 0,unbind:i.removeEventListener?function(c,b){if(g.fn.handleHash[c]){var d=0,f=g.fn.handleHash[c].length;for(d;f>d;d+=1){b.removeEventListener(c,g.fn.handleHash[c][d],!1)}}}:i.detachEvent?function(c,b){if(g.fn.handleHash[c]){var d=0,f=g.fn.handleHash[c].length;for(d;f>d;d+=1){b.detachEvent("on"+c,g.fn.handleHash[c][d])}}}:void 0,rclass:/[\n\t]/g,rspaces:/\s+/,arraify:function(f){var l=[];try{l=Array.prototype.slice.call(f,0)}catch(c){for(var d,l=[],b=0;d=f[b++];){l.push(d)}}return l},hasClass:function(c,b){return 0<=(" "+c.className+" ").replace(g.fn.rclass," ").indexOf(" "+b+" ")?!0:!1},addClass:function(y,c){if(c&&"string"==typeof c){var d=(c||"").split(g.fn.rspaces);if(1===y.nodeType){if(y.className){for(var l=" "+y.className+" ",b=y.className,f=0,n=d.length;n>f;f++){0>l.indexOf(" "+d[f]+" ")&&(b+=" "+d[f])}y.className=g.fn.trim(b)}else{y.className=c}}}},removeClass:function(b,c){if(c&&"string"==typeof c||void 0===c){var d=(c||"").split(g.fn.rspaces);if(1===b.nodeType&&b.className){if(c){for(var l=(" "+b.className+" ").replace(g.fn.rclass," "),f=0,n=d.length;n>f;f++){l=l.replace(" "+d[f]+" "," ")}b.className=g.fn.trim(l)}else{b.className=""}}}},getById:function(b){return i.getElementById(b)},getByTagName:function(c,b){return b=b||i,g.fn.arraify(b.getElementsByTagName(c))},getByClassName:function(c,b,d){if(b=b||i,b.getElementsByClassName){return g.fn.arraify(b.getElementsByClassName(c))}for(var c=c.replace(/\-/g,"\\-"),f=[],b=g.fn.getByTagName(d||"*",b),d=b.length,c=RegExp("(^|\\s)"+c+"(\\s|$)");d--;){c.test(b[d].className)&&f.push(b[d])}return f.reverse(),f},each:function(d,f){if(v!=d.length){for(var b=0,c=d.length;c>b&&!1!==f.call(d[b],b,d[b]);b++){}}else{for(name in d){f.call(d[name],name,d[name])}}},index:function(d,f){var b,c=f.length;for(b=0;c>b;b++){if(d==f[b]){return b}}return -1},trim:function(b){return b.replace(/^(\s|\u00A0)+/,"").replace(/(\s|\u00A0)+$/,"")},getjson:function(){var c=g.fn.getByClassName("hermit"),b=c.length-1;g.fn.each(c,function(l){var n=this;var f=[];var d={collect_id:12345,songs:[]};jQuery(".hermit-add-song").each(function(y,z){d.songs.push({name:jQuery(z).data("title"),url:jQuery(z).data("url"),artists:jQuery(z).data("author"),})});jQuery(["xiami","netease"]).each(function(z,y){stval=n.getAttribute(y);if(stval){stid=stval.split(":");f.push(jQuery.ajax({url:"http://app.atime.me/music-api-server/",data:{p:y,t:stid[0],i:stid[1]},success:function(A){var B=jQuery.parseJSON(A);for(var C in B.songs){d.songs.push(B.songs[C])}}}))}});jQuery.when.apply(undefined,f).then(function(){g.fn.createPlayListUI.call(n,d,l);l==b&&g.fn.autoPlay()});if(f.length==0){g.fn.createPlayListUI.call(n,d,l);l==b&&g.fn.autoPlay()}})},create:function(c){var b=this;o=null!=c?c:0;j=null!=j?j:0;g.sound&&(g.sound.destruct(),j==m[o].length&&(j=0));k.onready(function(){g.sound=k.createSound({id:"goXiami",url:m[o][j].src,volume:e,autoLoad:!1,ondataerror:function(){console.log("fuck")},onconnect:function(){console.log("connect")},onload:function(){3>this.readyState&&(g.fn.getByClassName("hermit-detail",b,"div")[0].innerHTML="\u97f3\u4e50\u64ad\u653e\u5668\u521d\u59cb\u5316\u5931\u8d25!")},whileloading:function(){g.fn.getByClassName("hermit-loaded",b,"div")[0].style.width=100*(this.bytesLoaded/this.bytesTotal)+"%"},whileplaying:function(){var d=g.fn.getByClassName("hermit-duration",b,"div")[0],l=g.fn.getByClassName("hermit-prosess-bar",b,"div")[0],f=100*(this.position/this.duration)+"%",n=g.fn.parseTime(this.position/1000)+"/"+g.fn.parseTime(this.duration/1000);!g.moving&&(l.style.width=f);d.innerHTML=n},onplay:function(){var d=g.fn.getByClassName("hermit-song",b,"div"),f=g.fn.getByClassName("hermit-detail",b,"div")[0];g.fn.each(d,function(){g.fn.removeClass(this,"selected")});g.fn.addClass(d[j],"selected");f.innerHTML=g.fn._expect(d[j].innerHTML,0,40,"...")+"  ("+(j+1)+"/"+m[o].length+")"},onpause:function(){},onfinish:function(){if(j++,g.sound.resume(),j<m[o].length){g.fn.create.call(b,o)}else{if(parseInt(b.getAttribute("loop"),10)){g.fn.getByClassName("hermit-song",b,"div")[0].click()}else{var d=g.fn.getByClassName("hermit-prosess-bar",b,"div")[0],n=g.fn.getByClassName("hermit-button",b,"div")[0],l=g.fn.getByClassName("hermit-duration",b,"div")[0],f=g.fn.getByClassName("hermit-song",b,"div");g.fn.each(f,function(){g.fn.removeClass(this,"selected")});d.style.width=0;o=j=null;g.sound=null;l.innerHTML="";g.fn.removeClass(n,"playing")}}}});g.sound.play()})},createPlayListUI:function(c,b){var d=g.fn.getByClassName("hermit-list",this,"div")[0],l="";if(m[b]=[],c.album_id||c.collect_id){c=c.songs,g.fn.each(c,function(){null!=this&&(m[b].push({src:this.url}),l+='<div class="hermit-song">'+this.name+" - "+this.artists+"</div>")})}else{var f=this.getAttribute("xiami").split(":")[1],f=f.split(",");g.fn.each(f,function(){null!=c[this]&&(m[b].push({src:c[this].url}),l+='<div class="hermit-song">'+c[this].name+" - "+c[this].artists+"</div>")})}d.innerHTML=l;g.fn.playEvent.call(this)},playEvent:function(){var l=this,d=g.fn.getByClassName("hermit-button",l,"div")[0],n=g.fn.getByClassName("hermit-volume",l,"div")[0],z=g.fn.getByClassName("hermit-listbutton",l,"div")[0],y=g.fn.getByClassName("hermit-list",l,"div")[0],c=g.fn.getByClassName("hermit-song",y,"div"),b=g.fn.getByClassName("hermit-prosess",l,"div")[0],f=g.fn.getByClassName("hermit-prosess-after",b,"div")[0];g.fn.each(c,function(){var A=g.fn.index(l,g.fn.getByClassName("hermit"));g.fn.bind(q,this,function(){var D=g.fn.index(this,c);if(o==A){D==j?d.click():function(){var E=g.fn.getByClassName("hermit")[o],F=g.fn.getByClassName("hermit-button",E,"div")[0];if(!g.fn.hasClass(F,"playing")){g.fn.addClass(F,"playing")}j=D;g.fn.create.call(l,A)}()}else{if(g.sound){var B=g.fn.getByClassName("hermit")[o],C=g.fn.getByClassName("hermit-button",B,"div")[0],B=g.fn.getByClassName("hermit-song",B,"div")[j];g.fn.removeClass(C,"playing");g.fn.removeClass(B,"selected");g.sound.resume()}j=D;g.fn.addClass(d,"playing");g.fn.create.call(l,A)}})});g.fn.bind(q,d,function(){var A=g.fn.index(l,g.fn.getByClassName("hermit"));if(g.fn.hasClass(d,"playing")){g.fn.removeClass(d,"playing"),g.sound.pause()}else{if(g.fn.addClass(d,"playing"),g.sound&&o==A){g.sound.play()}else{if(g.sound){var B=g.fn.getByClassName("hermit")[o],C=g.fn.getByClassName("hermit-button",B,"div")[0],B=g.fn.getByClassName("hermit-song",B,"div")[j];j=null;g.fn.removeClass(C,"playing");g.fn.removeClass(B,"selected")}g.fn.create.call(l,A)}}});g.fn.bind(q,z,function(){g.fn.hasClass(l,"unexpand")?(g.fn.removeClass(l,"unexpand"),y.style.height=a):(g.fn.addClass(l,"unexpand"),y.style.height=0)});g.fn.bind(q,n,function(){var A=g.fn.getByClassName("hermit-volume",null,"div");g.fn.hasClass(n,"muted")?(g.fn.each(A,function(){g.fn.removeClass(this,"muted")}),e=100,g.sound&&g.sound.setVolume(100)):(g.fn.each(A,function(){g.fn.addClass(this,"muted")}),e=0,g.sound&&g.sound.setVolume(0))});g.fn.bind(q,b,function(A){if(g.sound){var C=parseInt(g.fn._getStyle(b,"width")),B=g.fn._offset(b).left,A=g.fn._pageEvent(A).pageX-B,A=A/C*g.sound.duration;g.sound.setPosition(A)}});g.fn.bind(K,f,g.fn._bind(g.fn._start,l))},autoPlay:function(){var b=g.fn.getByClassName("hermit");g.fn.each(b,function(){if(parseInt(this.getAttribute("auto"),10)){return g.fn.getByClassName("hermit-button",this,"div")[0].click(),!1}})},_pageEvent:function(c){if(c=c||s.event,p&&c.touches.length){c.pageX=c.touches.item(0).pageX,c.pageY=c.touches.item(0).pageY}else{if("undefined"==typeof c.pageX){var d=i.documentElement,b=i.body;c.pageX=c.clientX+(d&&d.scrollLeft||b&&b.scrollLeft||0)-(d&&d.clientLeft||b&&b.clientLeft||0);c.pageY=c.clientY+(d&&d.scrollTop||b&&b.scrollTop||0)-(d&&d.clientTop||b&&b.clientTop||0)}}return c},_expect:function(d,f,b,c){return c=d.length>b-f?c:"",d=d.slice(f,b),d+c},_offset:function(c){var d=c.getBoundingClientRect(),b=c.ownerDocument,c=b.body,b=b.documentElement;return{top:d.top+(self.pageYOffset||b.scrollTop||c.scrollTop)-(b.clientTop||c.clientTop||0),left:d.left+(self.pageXOffset||b.scrollLeft||c.scrollLeft)-(b.clientLeft||c.clientLeft||0)}},_getStyle:function(b,c){return 5<r&&9>r?(c=c.replace(/^(\w)/g,function(f,d){return d.toUpperCase()}),b["client"+c]):i.defaultView.getComputedStyle(b,null).getPropertyValue(c)},_bind:function(b,c){return function(){return b.apply(c,arguments)}},_start:function(){g.moving=!0;g.fn.bind(w,i,g.fn._bind(g.fn._move,this));g.fn.bind(x,i,g.fn._bind(g.fn._end,this));g.fn.bind("touchcancel",i,g.fn._bind(g.fn._end,this))},_move:function(c){event=g.fn._pageEvent(c);var b=g.fn.getByClassName("hermit-prosess",this,"div")[0],c=g.fn.getByClassName("hermit-prosess-bar",b,"div")[0],d=parseInt(g.fn._getStyle(b,"width")),b=g.fn._offset(b).left,b=event.pageX-b,d=b/d;c.style.width=100*(1<d?1:d)+"%"},_end:function(){g.fn.getByClassName("hermit-prosess-after",this,"div")[0];if(g.sound){var c=g.fn.getByClassName("hermit-prosess",this,"div")[0],b=g.fn.getByClassName("hermit-prosess-bar",c,"div")[0],c=parseInt(g.fn._getStyle(c,"width")),b=parseInt(g.fn._getStyle(b,"width")),b=b/c,b=(1<b?1:b)*g.sound.duration;g.sound.setPosition(b)}g.fn.unbind(w,i);g.fn.unbind(x,i);g.fn.unbind("touchcancel",i);try{delete g.moving}catch(d){g.moving=v}g.fn.handleHash={}},ajaxp:function(b){setTimeout(function(){var d=(new Date).valueOf(),c=i.createElement("script");body=i.documentElement;head=body.getElementsByTagName("head")[0];callbackName="hermit"+parseInt(999999*Math.random());b.param.c=callbackName;b.param._=d;s[callbackName]=function(f){b.after.call(this,f);head.removeChild(c)};c.src=b.url+"?"+g.fn.serialize(b.param);head.appendChild(c)},0)},_loadScript:function(c,b){setTimeout(function(){var d=i.createElement("script");d.src=c;d.readyState?g.fn.bind("readystatechange",d,function(){("loaded"===d.readyState||"complete"===d.readyState)&&(b&&b(),g.fn.unbind("readystatechange",d))}):g.fn.bind("load",d,function(){b&&b();g.fn.unbind("load",d)});i.getElementsByTagName("head")[0].appendChild(d)},0)},serialize:function(b){var c=[];for(key in b){key=[key,b[key]].join("="),c.push(key)}return c.join("&")},parseTime:function(b){if(!isFinite(b)||0>b){return"--:--"}var c=Math.floor(b/60),b=Math.floor(b)%60;return(10>c?"0"+c:c)+":"+(10>b?"0"+b:b)}};g.init()})(window,document);